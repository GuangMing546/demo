(function(e){function t(t){for(var n,i,s=t[0],c=t[1],l=t[2],d=0,u=[];d<s.length;d++)i=s[d],Object.prototype.hasOwnProperty.call(r,i)&&r[i]&&u.push(r[i][0]),r[i]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(e[n]=c[n]);p&&p(t);while(u.length)u.shift()();return o.push.apply(o,l||[]),a()}function a(){for(var e,t=0;t<o.length;t++){for(var a=o[t],n=!0,i=1;i<a.length;i++){var s=a[i];0!==r[s]&&(n=!1)}n&&(o.splice(t--,1),e=c(c.s=a[0]))}return e}var n={},i={app:0},r={app:0},o=[];function s(e){return c.p+"static/js/"+({}[e]||e)+"."+{"chunk-2d0cbe26":"bbe615f4","chunk-2d0dddfd":"6cdc7279","chunk-2d0e4cf8":"daa85834","chunk-2d21b8c4":"13ba0b9d","chunk-2d221845":"7e0887fa","chunk-314c538d":"5912cbec","chunk-60ba4210":"fbce6869","chunk-79925216":"4fdd5495"}[e]+".js"}function c(t){if(n[t])return n[t].exports;var a=n[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,c),a.l=!0,a.exports}c.e=function(e){var t=[],a={"chunk-314c538d":1,"chunk-60ba4210":1,"chunk-79925216":1};i[e]?t.push(i[e]):0!==i[e]&&a[e]&&t.push(i[e]=new Promise((function(t,a){for(var n="static/css/"+({}[e]||e)+"."+{"chunk-2d0cbe26":"31d6cfe0","chunk-2d0dddfd":"31d6cfe0","chunk-2d0e4cf8":"31d6cfe0","chunk-2d21b8c4":"31d6cfe0","chunk-2d221845":"31d6cfe0","chunk-314c538d":"15e79d50","chunk-60ba4210":"97be345a","chunk-79925216":"81ac8a27"}[e]+".css",r=c.p+n,o=document.getElementsByTagName("link"),s=0;s<o.length;s++){var l=o[s],d=l.getAttribute("data-href")||l.getAttribute("href");if("stylesheet"===l.rel&&(d===n||d===r))return t()}var u=document.getElementsByTagName("style");for(s=0;s<u.length;s++){l=u[s],d=l.getAttribute("data-href");if(d===n||d===r)return t()}var p=document.createElement("link");p.rel="stylesheet",p.type="text/css",p.onload=t,p.onerror=function(t){var n=t&&t.target&&t.target.src||r,o=new Error("Loading CSS chunk "+e+" failed.\n("+n+")");o.code="CSS_CHUNK_LOAD_FAILED",o.request=n,delete i[e],p.parentNode.removeChild(p),a(o)},p.href=r;var h=document.getElementsByTagName("head")[0];h.appendChild(p)})).then((function(){i[e]=0})));var n=r[e];if(0!==n)if(n)t.push(n[2]);else{var o=new Promise((function(t,a){n=r[e]=[t,a]}));t.push(n[2]=o);var l,d=document.createElement("script");d.charset="utf-8",d.timeout=120,c.nc&&d.setAttribute("nonce",c.nc),d.src=s(e);var u=new Error;l=function(t){d.onerror=d.onload=null,clearTimeout(p);var a=r[e];if(0!==a){if(a){var n=t&&("load"===t.type?"missing":t.type),i=t&&t.target&&t.target.src;u.message="Loading chunk "+e+" failed.\n("+n+": "+i+")",u.name="ChunkLoadError",u.type=n,u.request=i,a[1](u)}r[e]=void 0}};var p=setTimeout((function(){l({type:"timeout",target:d})}),12e4);d.onerror=d.onload=l,document.head.appendChild(d)}return Promise.all(t)},c.m=e,c.c=n,c.d=function(e,t,a){c.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},c.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.t=function(e,t){if(1&t&&(e=c(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(c.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)c.d(a,n,function(t){return e[t]}.bind(null,n));return a},c.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return c.d(t,"a",t),t},c.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},c.p="",c.oe=function(e){throw console.error(e),e};var l=window["webpackJsonp"]=window["webpackJsonp"]||[],d=l.push.bind(l);l.push=t,l=l.slice();for(var u=0;u<l.length;u++)t(l[u]);var p=d;o.push([0,"chunk-vendors"]),a()})({0:function(e,t,a){e.exports=a("56d7")},"034f":function(e,t,a){"use strict";var n=a("85ec"),i=a.n(n);i.a},"06a8":function(e,t,a){},"0d88":function(e,t,a){"use strict";var n=a("5d5b"),i=a.n(n);i.a},1:function(e,t){},1526:function(e,t,a){e.exports=a.p+"static/img/cycle.c25fb81d.svg"},"1f00":function(e,t,a){"use strict";var n=a("de3a"),i=a.n(n);i.a},2:function(e,t){},"22b2":function(e,t,a){"use strict";var n=a("06a8"),i=a.n(n);i.a},"2e83":function(e,t,a){e.exports=a.p+"static/img/record.ab081e0d.png"},3:function(e,t){},"391b":function(e,t,a){e.exports=a.p+"static/img/start.f43f033b.svg"},"39cf":function(e,t,a){e.exports=a.p+"static/img/ok.463ab0e4.svg"},"3d6c":function(e,t,a){"use strict";var n=a("60b2"),i=a.n(n);i.a},4:function(e,t){},5010:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));a("99af"),a("a15b"),a("d81d"),a("b64b"),a("42454"),a("2593");var n=a("98dc"),i=a.n(n);a.d(t,"b",(function(){return i.a}));a("8103");var r=function(e,t,a,n){var i=e+a<e?e+a:e,r=e+a>e?e+a:e,o=t+n<t?t+n:t,s=t+n>t?t+n:t;return{x1:i,x2:r,y1:o,y2:s}}},"56d7":function(e,t,a){"use strict";a.r(t);var n={};a.r(n),a.d(n,"user",(function(){return f})),a.d(n,"isLogin",(function(){return m}));a("d3b7"),a("e260"),a("e6cf"),a("cca6"),a("a79d");var i=a("2b0e"),r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"app"}},[a("transition",{attrs:{name:"fade",mode:"out-in"}},[a("router-view")],1)],1)},o=[],s=(a("034f"),a("2877")),c={},l=Object(s["a"])(c,r,o,!1,null,null,null),d=l.exports,u=a("8c4f"),p=a("2f62"),h=a("63e0"),f=function(e){return e.user},m=function(e){return e.isLogin},g={isLogin:!1,user:{}},v=g,y={setUser:function(e,t){e.isLogin=!0,e.user=t},signOut:function(e){e.user={},sessionStorage.clear(),e.isLogin=!1}},b=y,x=a("0e44");i["default"].use(p["a"]);var k=new p["a"].Store({actions:h,getters:n,state:v,mutations:b,plugins:[Object(x["a"])({storage:window.sessionStorage})]}),w=a("5c96"),D=a.n(w),C=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{margin:"20px 10px"}},[a("link",{attrs:{rel:"stylesheet",type:"text/css",href:"//at.alicdn.com/t/font_1581731_z26piaggta.css"}}),a("div",{staticStyle:{"margin-left":"35px"}},[e.isEdit?a("el-button",{staticStyle:{"margin-right":"15px"},attrs:{icon:"el-icon-back",type:"info",plain:""},on:{click:e.handleBack}},[e._v("返回")]):e._e(),a("el-button",{attrs:{icon:"iconfont icon-save-as",type:"primary",plain:""},on:{click:function(t){return e.handleShowSaveDialog("saveAs")}}},[e._v(" 另存为")]),a("el-button",{staticStyle:{"margin-left":"15px"},attrs:{icon:"iconfont icon-save",type:"success",plain:""},on:{click:function(t){return e.handleShowSaveDialog("save")}}},[e._v(" 保存")])],1),a("el-row",{staticClass:"formContainer"},[a("el-col",{staticClass:"formList",attrs:{span:7}},[a("el-form",{ref:"form",staticClass:"b-a",staticStyle:{"overflow-y":"scroll"},attrs:{"label-width":"100px"}},[a("h2",{staticStyle:{"text-align":"center"}},[e._v("元素栏")]),a("el-collapse",{staticStyle:{padding:"15px"}},[a("el-collapse-item",{attrs:{title:"通用元素",name:"1"}},[a("draggable",{attrs:{clone:e.cloneData,list:e.commonList,options:e.dragOptionsLeft}},[a("transition-group",{staticClass:"form-list-group",attrs:{type:"transition",name:"flip-list",tag:"div"}},e._l(e.commonList,(function(e,t){return a("renders",{key:t,attrs:{ele:e.ele,obj:e.obj}})})),1)],1)],1)],1)],1)],1),a("el-col",{staticClass:"formList",attrs:{span:17}},[a("el-form",{ref:"form",staticClass:"b-a",staticStyle:{"overflow-y":"scroll"},attrs:{model:e.formData,"label-width":"120px"}},[a("h2",{staticStyle:{"text-align":"center"}},[e._v("表单")]),a("draggable",{attrs:{clone:e.cloneData,list:e.dataList,options:e.dragOptionsRight}},[a("transition-group",{staticClass:"form-list-group-right",attrs:{type:"transition",name:e.drag?null:"flip-list",tag:"div"}},e._l(e.dataList,(function(t,n){return a("renders",{key:n,attrs:{ele:t.ele,obj:t.obj,index:n,"config-icon":!0},on:{handleChangeVal:function(a){return e.handleChangeVal(a,t)},handleConfigElement:e.handleConfig,handleRemoveElement:e.handleRemoveElement}})})),1)],1)],1)],1)],1),a("el-dialog",{attrs:{title:"编辑属性",visible:e.dialogVisible,"close-on-click-modal":!1,width:"40%","before-close":e.handleCancel},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("el-form",{ref:"attrForm",attrs:{model:e.attrForm,size:"small"}},[e._l(e.attrsList,(function(t){return a("el-form-item",{key:t.name,attrs:{label:t.name,prop:t.attribute,rules:{required:!0,message:t.name+"不能为空",trigger:"blur"},"label-width":"100px"}},["input"===t.type?a("el-input",{attrs:{disabled:"sell"!==t.clientType},model:{value:e.attrForm[t.attribute],callback:function(a){e.$set(e.attrForm,t.attribute,a)},expression:"attrForm[item.attribute]"}}):e._e(),"inputNumber"===t.type?a("el-input-number",{attrs:{disabled:"sell"!==t.clientType,precision:0},model:{value:e.attrForm[t.attribute],callback:function(a){e.$set(e.attrForm,t.attribute,a)},expression:"attrForm[item.attribute]"}}):e._e(),"singleCheck"===t.type?a("el-checkbox",{attrs:{disabled:"sell"!==t.clientType},model:{value:e.attrForm[t.attribute],callback:function(a){e.$set(e.attrForm,t.attribute,a)},expression:"attrForm[item.attribute]"}}):e._e()],1)})),e.attrForm.items?a("div",[a("el-divider",[e._v("选项")]),e._l(e.attrForm.items,(function(t,n){return a("el-form-item",{key:t.value,attrs:{label:"选项"+(n+1),prop:"items."+n+".label_name",rules:{required:!0,message:"选项内容不能为空",trigger:"blur"},"label-width":"100px"}},[a("el-row",[a("el-col",{attrs:{span:21}},[a("el-input",{attrs:{placeholder:"选项内容"},model:{value:t.label_name,callback:function(a){e.$set(t,"label_name",a)},expression:"item.label_name"}})],1),a("el-col",{attrs:{span:3}},[a("el-button",{attrs:{size:"small"},on:{click:function(a){return a.preventDefault(),e.removeOption(t)}}},[e._v("删除")])],1)],1)],1)})),a("el-form-item",[a("el-button",{staticStyle:{"margin-left":"100px"},on:{click:e.addOption}},[e._v("新增选项")])],1)],2):e._e()],2),a("span",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.handleCancel}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.handleOk}},[e._v("确 定")])],1)],1),a("el-dialog",{attrs:{title:"保存",visible:e.saveDialogVisible,width:"30%"},on:{"update:visible":function(t){e.saveDialogVisible=t}}},[a("el-form",{ref:"saveForm",attrs:{model:e.saveForm,"label-width":"80px",rules:e.saveRules}},[a("el-form-item",{attrs:{label:"表单名称",prop:"name"}},[a("el-input",{attrs:{placeholder:"请输入表单名称"},model:{value:e.saveForm.name,callback:function(t){e.$set(e.saveForm,"name",t)},expression:"saveForm.name"}})],1)],1),a("span",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.onSaveDialogClose}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.handleSubmit}},[e._v("保 存")])],1)],1)],1)},O=[],I=(a("a4d3"),a("4de4"),a("4160"),a("c975"),a("a434"),a("b0c0"),a("e439"),a("dbb4"),a("b64b"),a("159b"),a("2fa7")),_=a("310e"),S=a.n(_),j=(a("e25e"),function(e,t){return[t("el-input",{props:{value:e.obj.value||""},attrs:{maxlength:parseInt(e.obj.maxlength)||20,placeholder:e.obj.attr.placeholder||"这是一个输入框"},on:{change:function(t){e.obj.value=event.currentTarget.value,e.$emit("handleChangeVal",event.currentTarget.value)}}})]}),N={type:"input",config:!0,value:"",attr:{label:"输入框",placeholder:"这是一个输入框",require:!0,maxLength:50},attrName:[{name:"标题",attribute:"label",type:"input",clientType:"sell"},{name:"提示语",attribute:"placeholder",type:"input",clientType:"sell"},{name:"是否必填",attribute:"require",type:"singleCheck",clientType:"sell"},{name:"最大长度",attribute:"maxLength",type:"inputNumber",clientType:"sell"}]},P=(a("d81d"),function(e,t){return[t("el-radio-group",{props:{value:e.obj.value||"1"},on:{input:function(t){e.obj=Object.assign(e.obj,{value:t}),e.$emit("handleChangeVal",t)}}},e.obj.attr.items.map((function(e){return t("el-radio",{props:{label:e.label_value}},e.label_name)})))]}),L={type:"radio",config:!0,value:[1,2],attr:{label:"单选框",require:!0,items:[{label_value:1,label_name:"单选框1"},{label_value:2,label_name:"单选框2"}]},attrName:[{name:"标题",attribute:"label",type:"input",clientType:"sell"},{name:"是否必填",attribute:"require",type:"singleCheck",clientType:"sell"}]},F=function(e,t){return[t("el-checkbox-group",{props:{value:e.obj.value||[]},on:{input:function(t){e.obj.value=t,e.$emit("handleChangeVal",t)}}},e.obj.attr.items.map((function(e){return t("el-checkbox",{props:{label:e.label_value}},e.label_name)})))]},E={type:"checkbox",config:!0,value:[1,2],ruleError:"该选项不能为空",visibility:!0,attr:{label:"多选框",require:!0,items:[{label_value:1,label_name:"多选框1"},{label_value:2,label_name:"多选框2"}]},attrName:[{name:"标题",attribute:"label",type:"input",clientType:"sell"},{name:"是否必填",attribute:"require",type:"singleCheck",clientType:"sell"}]},T=function(e,t){return[t("el-upload",{props:{value:e.obj.value||""},attrs:{listType:"picture-card",action:"#",autoUpload:!1},on:{}},[t("i",{class:{"el-icon-plus":!0}})])]},$={type:"photo",config:!0,value:"",attr:{label:"上传图片",require:!0},attrName:[{name:"标题",attribute:"label",type:"input",clientType:"sell"},{name:"是否必填",attribute:"require",type:"singleCheck",clientType:"sell"}]},B=function(e,t){return[t("el-upload",{props:{value:e.obj.value||""},attrs:{listType:"picture-card",action:"#",autoUpload:!1},on:{}},[t("i",{class:{"el-icon-plus":!0}})])]},M={type:"video",config:!0,value:"",attr:{label:"上传视频",require:!0},attrName:[{name:"标题",attribute:"label",type:"input",clientType:"sell"},{name:"是否必填",attribute:"require",type:"singleCheck",clientType:"sell"}]},A=a("2e83"),U=a.n(A),q=function(e,t){return[t("el-image",{props:{src:U.a}})]},z={type:"record",config:!0,value:"",attr:{label:"录音",require:!0},attrName:[{name:"标题",attribute:"label",type:"input",clientType:"sell"},{name:"是否必填",attribute:"require",type:"singleCheck",clientType:"sell"}]},G=function(e,t){return[t("el-upload",{props:{value:e.obj.value||""},attrs:{listType:"picture-card",action:"#",autoUpload:!1},on:{}},[t("i",{class:{"el-icon-plus":!0}})])]},R={type:"file",config:!0,value:"",attr:{label:"上传文件",require:!0},attrName:[{name:"标题",attribute:"label",type:"input",clientType:"sell"},{name:"是否必填",attribute:"require",type:"singleCheck",clientType:"sell"}]},V=function(e,t){return[t("el-select",{props:{value:e.obj.value||""},attrs:{placeholder:e.obj.attr.placeholder||"请选择",filterable:!0},on:{change:function(t){e.obj.value=t,e.$emit("handleChangeVal",t)}}},e.obj.attr.items.map((function(e){return t("el-option",{props:{label:e.label_name,value:e.label_value}})})))]},Y={type:"select",config:!0,value:"",ruleError:"该选项不能为空",attr:{label:"人员选择",require:!0,placeholder:"",items:[]},attrName:[{name:"控件名称",attribute:"label",type:"input",clientType:"sell"},{name:"是否必填",attribute:"require",type:"singleCheck",clientType:"sell"},{name:"Placeholder",attribute:"placeholder",type:"input",clientType:"sell"}]},X={input:N,radio:L,checkBox:E,photo:$,video:M,file:R,record:z},J=[];for(var K in X)J.push({ele:K,obj:X[K]});var H={selectPerson:Y},Z=[];for(var W in H)Z.push({ele:W,obj:H[W]});a("99af"),a("a9e3");var Q=function(e,t){var a=[];return a.push(t("i",{attrs:{class:"el-icon-setting"},on:{click:function(){e.$emit("handleConfigElement",e.index)}}})),a.push(t("i",{attrs:{class:"el-icon-delete"},on:{click:function(){e.$emit("handleRemoveElement",e.index)}}})),t("div",{class:{"item-icon":!0}},a)},ee={input:j,radio:P,checkBox:F,photo:T,record:q,video:B,file:G,selectPerson:V},te={name:"renders",render:function(e){var t=this.configIcon&&this.obj.config?Q(this,e):[];return e("el-form-item",{props:{label:this.obj.attr.label+"："},style:{position:"relative"},class:{items:!0}},ee[this.ele](this,e).concat(t))},props:{ele:{type:String,default:"input"},obj:{type:Object,default:{}},configIcon:{type:Boolean,default:!1},index:{type:Number,default:0}}},ae=a("622a"),ne=a("ed08");function ie(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function re(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ie(a,!0).forEach((function(t){Object(I["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ie(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var oe={name:"home",data:function(){return{commonList:J,formBaseList:Z,dataList:[],formData:{},formName:"",formID:"",isEdit:!1,drag:!1,dialogVisible:!1,attrForm:{},attrsList:[],editIndex:0,saveDialogVisible:!1,saveForm:{type:"",name:""},saveRules:{name:[{required:!0,message:"请输入表单名称",trigger:"blur"}]}}},components:{draggable:S.a,renders:te},methods:{initData:function(){var e=this;this.$route.params.formId&&(this.formID=this.$route.params.formId,this.isEdit=!0,this.axios.post(ae["b"].downloadOneForm,this.qs.stringify({formId:this.$route.params.formId,userId:this.user.id})).then((function(t){1===t.data.resultCode&&(e.dataList=JSON.parse(t.data.objData.content),e.formName=t.data.objData.name)})).catch((function(t){e.$message({type:"error",message:t.response.data.message})})))},handleBack:function(){this.$router.go(-1)},handleShowSaveDialog:function(e){switch(e){case"saveAs":this.saveDialogVisible=!0;break;case"save":this.isEdit?this.handleUpdateForm():this.saveDialogVisible=!0;break}},handleUpdateForm:function(){var e=this;for(var t in this.dataList)this.dataList[t].obj.value="",this.dataList[t].obj.id=Object(ne["b"])(2);var a=new FormData;a.append("formName",this.formName);var n=new Blob([JSON.stringify(this.dataList)],{type:"text/plain;charset=utf-8"});a.append("formFile",new File([n],"form"+Object(ne["c"])(10)+".txt")),a.append("oldFormId",this.formID),this.axios.post(ae["b"].updateForm,a).then((function(t){1===t.data.resultCode&&e.$message({type:"success",message:t.data.message})})).catch((function(t){e.$message({type:"error",message:t.response.data.message})}))},handleSubmit:function(){var e=this;this.$refs.saveForm.validate((function(t){if(t){for(var a in e.dataList)e.dataList[a].obj.value="",e.dataList[a].obj.id=Object(ne["b"])(2);console.log(e.dataList),console.log(JSON.stringify(e.dataList));var n=new FormData;n.append("formName",e.saveForm.name);var i=new Blob([JSON.stringify(e.dataList)],{type:"text/plain;charset=utf-8"});n.append("formFile",new File([i],"form"+Object(ne["c"])(10)+".txt")),e.axios.post(ae["b"].uploadForm,n).then((function(t){1===t.data.resultCode?(e.$message({message:t.data.message,type:"success"}),e.resetSaveForm(),e.saveDialogVisible=!1):e.$message({message:t.data.message})})).catch((function(t){e.$message({type:"error",message:t.response.data.message})}))}}))},cloneData:function(e){return JSON.parse(JSON.stringify(e))},handleChangeVal:function(e,t){this.$set(this.formData,t.obj.name,e)},handleConfig:function(e){this.editIndex=e,this.attrsList=this.dataList[e].obj.attrName;var t=Object.assign({},this.dataList[e].obj);this.attrForm=Object(ne["a"])(t.attr),this.attrForm=Object.assign({},this.attrForm),this.dialogVisible=!0},handleRemoveElement:function(e){this.dataList.splice(e,1)},onSaveDialogClose:function(){this.resetSaveForm(),this.saveDialogVisible=!1},resetSaveForm:function(){this.$refs.saveForm.resetFields(),this.saveForm={type:"",name:""}},handleOk:function(){var e=this;this.attrForm.items?this.$refs["attrForm"].validate((function(t){t&&(e.dataList[e.editIndex].obj.attr=Object(ne["a"])(e.attrForm),e.handleCancel())})):(this.dataList[this.editIndex].obj.attr=Object(ne["a"])(this.attrForm),this.handleCancel())},handleCancel:function(){var e=this;this.dialogVisible=!1,setTimeout((function(t){e.attrForm={},e.$refs["attrForm"].resetFields()}),500)},removeOption:function(e){var t=this.attrForm.items.indexOf(e);-1!==t&&this.attrForm.items.splice(t,1)},addOption:function(){var e=this.attrForm.items.length;this.attrForm.items.push({label_name:"",label_value:e+1})}},computed:re({dragOptionsLeft:function(){return{animation:50,ghostClass:"ghost",group:{name:"shared",pull:"clone",revertClone:!1},sort:!1}},dragOptionsRight:function(){return{animation:50,ghostClass:"ghost",group:{put:["shared"]}}}},Object(p["b"])({user:"user"})),created:function(){this.initData()}},se=oe,ce=(a("6eb6"),Object(s["a"])(se,C,O,!1,null,null,null)),le=ce.exports,de=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.show?a("G6Editor",{staticStyle:{margin:"10px"},attrs:{mode:"edit",data:e.flowData,name:e.flowName,id:e.flowID,"is-edit":e.isEdit,status:e.status}}):e._e()},ue=[],pe=a("bf50");pe["a"].install=function(e){e.component(pe["a"].name,pe["a"])};var he=pe["a"],fe={name:"Editor",data:function(){return{flowID:-1,flowName:"",isEdit:!1,userID:"",show:!1,flowData:{},status:""}},components:{G6Editor:he},methods:{getFlowData:function(){var e=this;this.$route.params.flowId?(this.flowID=this.$route.params.flowId,this.flowName=this.$route.params.flowName,this.userID=this.$route.params.userId,this.isEdit=!0,this.status=this.$route.params.status,"normal"===this.status?this.axios.post(ae["a"].downloadOneProcess,this.qs.stringify({processId:this.flowID,userId:this.userID})).then((function(t){1===t.data.resultCode&&(e.flowData=JSON.parse(t.data.objData.content),e.flowName=t.data.objData.name,e.show=!0)})).catch((function(t){e.$message({type:"error",message:t.response.data.message})})):"draft"===this.status&&this.axios.get(ae["a"].draftContent,{params:{id:this.flowID}}).then((function(t){1===t.data.resultCode&&(e.flowData=JSON.parse(t.data.objData.content),e.flowName=t.data.objData.name,e.show=!0)})).catch((function(t){e.$message({type:"error",message:t.response.data.message})}))):this.show=!0}},created:function(){this.getFlowData()}},me=fe,ge=Object(s["a"])(me,de,ue,!1,null,"bc20d698",null),ve=ge.exports;i["default"].use(u["a"]);var ye=[{path:"/",name:"Login",component:function(e){return a.e("chunk-60ba4210").then(function(){var t=[a("a55b")];e.apply(null,t)}.bind(this)).catch(a.oe)},meta:{title:"卖家端管理系统登录",requireLogin:!1}},{path:"/main",component:function(e){return a.e("chunk-314c538d").then(function(){var t=[a("cd56")];e.apply(null,t)}.bind(this)).catch(a.oe)},meta:{title:"首页",requireLogin:!0},children:[{path:"/",name:"Home",component:function(){return a.e("chunk-2d0dddfd").then(a.bind(null,"82f3"))},meta:{title:"首页",requireLogin:!0}},{path:"formList",name:"FormList",component:function(e){return a.e("chunk-2d0cbe26").then(function(){var t=[a("4c23")];e.apply(null,t)}.bind(this)).catch(a.oe)},meta:{title:"表单列表",requireLogin:!0}},{path:"flowList",name:"FlowList",component:function(e){return a.e("chunk-2d221845").then(function(){var t=[a("cb4d")];e.apply(null,t)}.bind(this)).catch(a.oe)},meta:{title:"流程列表",requireLogin:!0}},{path:"userList",name:"UserList",component:function(e){return a.e("chunk-2d21b8c4").then(function(){var t=[a("bff0")];e.apply(null,t)}.bind(this)).catch(a.oe)},meta:{title:"用户列表",requireLogin:!0}}]},{path:"/graph",name:"GraphEditor",component:ve,meta:{title:"流程编辑器",requireLogin:!0}},{path:"/preview",name:"Preview",component:function(e){return a.e("chunk-79925216").then(function(){var t=[a("948d")];e.apply(null,t)}.bind(this)).catch(a.oe)},meta:{title:"流程预览器",requireLogin:!0}},{path:"/form",name:"FormBuilder",component:le,meta:{title:"表单编辑器",requireLogin:!0}},{path:"/test",name:"test",component:function(e){return a.e("chunk-2d0e4cf8").then(function(){var t=[a("928a")];e.apply(null,t)}.bind(this)).catch(a.oe)},meta:{title:"API测试",requireLogin:!1}}],be=new u["a"]({routes:ye});be.beforeEach((function(e,t,a){e.meta.title&&(document.title=e.meta.title),e.meta.requireLogin?k.state.isLogin?a():(a({path:"/",query:{redirect:e.fullPath}}),Object(w["Message"])({message:"请登录后操作",type:"warning"})):a()}));var xe=be,ke=a("bc3a"),we=a.n(ke),De=a("4328"),Ce=a.n(De),Oe=a("279c"),Ie=a.n(Oe),_e=a("21a6"),Se=a.n(_e);a("0fae");i["default"].config.productionTip=!1,i["default"].use(D.a),i["default"].prototype.axios=we.a,i["default"].prototype.bcrypt=Ie.a,i["default"].prototype.qs=Ce.a,i["default"].prototype.FileSaver=Se.a;var je=!1;we.a.interceptors.response.use((function(e){return je=!1,e}),(function(e){return 2001===e.response.data.resultCode?je?Promise.reject(e):(xe.push({path:"/"}),k.commit("signOut"),Object(w["Message"])({message:"登录过期，请重新登录后操作",type:"error"}),je=!0,Promise.reject(e)):Promise.reject(e)}));var Ne=new i["default"]({router:xe,store:k,render:function(e){return e(d)}}).$mount("#app");t["default"]=Ne},"5d5b":function(e,t,a){},"60b2":function(e,t,a){},"622a":function(e,t,a){"use strict";a.d(t,"a",(function(){return n})),a.d(t,"c",(function(){return i})),a.d(t,"b",(function(){return o})),a.d(t,"d",(function(){return r}));var n={saveDraft:"/api/draft",draftContent:"/api/draftContent",deleteDraft:"/api/draft",updateDraft:"/api/draft",getDraftList:"/api/draftList",runTest:"/api/runTest",uploadProcess:"/api/uploadProcess",downloadOneProcess:"/api/downloadOneProcess",deleteProcess:"/api/deleteProcess",updateProcess:"/api/updateProcess",getProcessListByUser:"/api/getProcessList"},i={login:"/api/login",register:"/api/Register",sendEmailCode:"/api/sendEmailCode",sendSmsCode:"/api/sendSmsCode",updatePassword:"/api/updatePassword",findPassword:"/api/findPassword",updatePasswordByAdmin:"/api/updatePasswordByAdmin"},r={ban:"/api/ban",addUseTime:"/api/addUseTime",updateUserMsg:"/api/updateUserMsg",getAllUser:"/api/getALLUser",getBanUser:"/api/getBanUser",getUser:"/api/getUser",getUserByID:"/api/getUserByID",getSonUsers:"/api/getSonUsers",getUserGroups:"/api/getUserGroups"},o={deleteForm:"/api/deleteForm",updateForm:"/api/updateForm",downloadOneForm:"/api/downloadOneForm",getFormListByUser:"/api/getFormList",uploadForm:"/api/uploadForm"}},"63e0":function(e,t){},"6eb6":function(e,t,a){"use strict";var n=a("ca25"),i=a.n(n);i.a},"6fcf":function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div")},i=[],r=(a("7db0"),a("4160"),a("4e82"),a("e25e"),a("159b"),a("07cd")),o=a.n(r),s=a("5010"),c=a("3c4c"),l=a.n(c),d={init:function(){o.a.registerNode("customNode",{draw:function(e,t){var a=e.size;a||(a=[170,34]);var n=parseInt(a[0]),i=parseInt(a[1]),r=e.color,o=-n/2,c=-i/2,d="rect"+Object(s["b"])(),u=t.addShape("rect",{attrs:{id:d,x:o,y:c,width:n,height:i,stroke:"#ced4d9",fill:"#fff",radius:4}});if(t.addShape("rect",{attrs:{x:o,y:c,width:4,height:i,fill:r,parent:d,radius:[4,0,0,4]}}),t.addShape("rect",{zIndex:-99,attrs:{x:o,y:c,width:n,height:i,fill:"#ced4d9",radius:8,opacity:.3,isAnimate:!0}}),t.addShape("image",{attrs:{x:o+16,y:c+8,width:16,height:16,img:e.image,parent:d}}),t.addShape("image",{attrs:{x:o+n-32,y:c+8,width:16,height:16,parent:d,img:e.stateImage}}),e.backImage){var p=new l.a.Rect({attrs:{x:o,y:c,width:n,height:i,fill:"#fff",radius:4}});t.addShape("image",{attrs:{x:o,y:c,width:n,height:i,img:e.backImage,clip:p}})}if(e.label&&t.addShape("text",{attrs:{id:"label"+Object(s["b"])(),x:o+n/2,y:c+i/2,textAlign:"center",textBaseline:"middle",text:e.label,parent:d,fill:"#565758"}}),e.inPoints)for(var h=0;h<e.inPoints.length;h++){var f=void 0,m=0;m=0===e.inPoints[h][0]?0:i,f=n*e.inPoints[h][1];var g="circle"+Object(s["b"])();t.addShape("circle",{attrs:{id:"circle"+Object(s["b"])(),parent:g,x:f+o,y:m+c,r:10,isInPointOut:!0,fill:"#1890ff",opacity:0}}),t.addShape("circle",{attrs:{id:g,x:f+o,y:m+c,r:3,isInPoint:!0,fill:"#fff",stroke:"#1890ff",opacity:0}})}if(e.outPoints)for(var v=0;v<e.outPoints.length;v++){var y=void 0,b=0;b=0===e.outPoints[v][0]?0:i,y=n*e.outPoints[v][1];var x="circle"+Object(s["b"])();t.addShape("circle",{attrs:{id:"circle"+Object(s["b"])(),parent:x,x:y+o,y:b+c,r:10,isOutPointOut:!0,fill:"#1890ff",opacity:0}}),t.addShape("circle",{attrs:{id:x,x:y+o,y:b+c,r:3,isOutPoint:!0,fill:"#fff",stroke:"#1890ff",opacity:0}})}return t.sort(),u},setState:function(e,t,a){var n=a.getContainer(),i=n.get("children")[1],r=n.findAll((function(e){return e._attrs.parent===i._attrs.id})),o=n.findAll((function(e){return e._attrs.isInPoint||e._attrs.isOutPoint})),s=function(){i.attr("fill","#f3f9ff"),i.attr("stroke","#6ab7ff"),i.attr("cursor","move"),r.forEach((function(e){e.attr("cursor","move")})),o.forEach((function(e){e.attr("opacity",1)}))},c=function(){i.attr("fill","#fff"),i.attr("stroke","#ced4d9"),o.forEach((function(e){e.attr("opacity",0)}))},l=function(){i.attr("fill","#f3f9ff"),i.attr("stroke","#6ab7ff"),o.forEach((function(e){e.attr("opacity",1)}))},d=function(){i.attr("fill","#fff"),i.attr("stroke","#FF0000"),o.forEach((function(e){e.attr("opacity",1)}))};switch(e){case"selected":case"hover":t?s():c();break;case"addEdgeHover":t?l():c();break;case"running":t?n.find((function(e){e._attrs.isAnimate&&e.animate({x:e._attrs.x-10,y:e._attrs.y-10,width:e._attrs.width+20,height:e._attrs.height+20,repeat:!0},1e3,"easeLinear")})):n.find((function(e){e._attrs.isAnimate&&(e.stopAnimate(),e.attr("width",e._attrs.width-20),e.attr("height",e._attrs.height-20),e.attr("x",e._attrs.x+10),e.attr("y",e._attrs.y+10))}));break;case"error":t?d():c();break}}})}},u=d,p=(a("99af"),3),h={init:function(){var e=[[0,1],[0,2],[1,2],[0,1,1,2],[0,2,1,2],[1,2,1,2],[2,2,1,2],[3,2,1,2],[4,2,1,2]],t=[4,2,1,2],a=9;o.a.registerEdge("customEdge",{draw:function(e,t){var a,n,i,r;"string"===typeof e.source&&(e.source=e.sourceNode),e.start||(e.start={x:0,y:17}),e.end||(e.end={x:0,y:-17}),e.source.x?i=e.source:(a=e.source.getModel(),i={x:a.x+e.start.x,y:a.y+e.start.y}),"string"===typeof e.target&&(e.target=e.targetNode),e.target.x?r=e.target:(n=e.target.getModel(),r={x:n.x+e.end.x,y:n.y+e.end.y});var o=[],c=Math.abs(r.x-i.x);o=(r.x,i.x,[["M",i.x,i.y],["C",i.x,i.y+c/(c/50),r.x,r.y-c/(c/50),r.x,r.y-4],["L",r.x,r.y]]);var l=1;l=l>p?l:p;var d=10*l/3,u=4*l/3,h=4*l,f=[["M",-d,u],["L",0,0],["L",-d,-u],["A",h,h,0,0,1,-d,u],["Z"]],m=t.addShape("path",{attrs:{id:"edge"+Object(s["b"])(),path:o,stroke:e.warn?"#E6A23C":"#b8c3ce",lineAppendWidth:10,endArrow:{path:f}}});return m},afterDraw:function(n,i){if(n.source.getModel().isDoingStart&&n.target.getModel().isDoingEnd){for(var r=i.get("children")[0],o=r.getTotalLength(),s=[],c=0;c<o;c+=a)s=s.concat(t);var l=0;r.animate({onFrame:function(){var t={lineDash:e[l].concat(s)};return l=(l+1)%a,t},repeat:!0},3e3)}},setState:function(e,t,a){var n=a.getContainer(),i=n.get("children")[0],r=function(){i.attr("stroke","#6ab7ff")},o=function(){i.attr("stroke",a._cfg.originStyle.stroke)};switch(e){case"selected":case"hover":t?r():o();break}}}),o.a.registerEdge("link-edge",{draw:function(e,t){var a,n,i,r;e.source.x?i=e.source:(a=e.source.getModel(),i={x:a.x+e.start.x,y:a.y+e.start.y}),e.target.x?r=e.target:(n=e.target.getModel(),r={x:n.x+e.end.x,y:n.y+e.end.y});var o=[];o=[["M",i.x,i.y],["L",r.x,r.y]];var c=t.addShape("path",{attrs:{id:"edge"+Object(s["b"])(),path:o,stroke:"#1890FF",strokeOpacity:.9,lineDash:[5,5]}});return c}})}},f=h,m={name:"Flow",data:function(){return{page:null}},created:function(){this.init()},methods:{init:function(){u.init(),f.init()}}},g=m,v=a("2877"),y=Object(v["a"])(g,n,i,!1,null,null,null);t["a"]=y.exports},"85ec":function(e,t,a){},"8bd0":function(e,t,a){},"99b5":function(e,t,a){},"9be8":function(e,t,a){"use strict";var n=a("8bd0"),i=a.n(n);i.a},b8f1:function(e,t,a){e.exports=a.p+"static/img/end.902a1416.svg"},bf50:function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.testLoading,expression:"testLoading"}],style:{width:e.width},attrs:{id:"mountNode","element-loading-text":"预跑中……"}},[a("div",{staticClass:"editor"},[a("context-menu"),a("toolbar",{attrs:{"is-edit":e.isEdit},on:{save:e.handleSave,test:e.handleTest}}),a("div",{staticStyle:{height:"42px"}}),a("div",{staticClass:"bottom-container"},[a("item-panel"),a("detail-panel"),a("minimap"),a("page",{attrs:{height:e.height,width:e.width,data:e.data}})],1)],1),a("Flow"),a("el-dialog",{attrs:{title:"保存",visible:e.saveDialogVisible,width:"30%"},on:{"update:visible":function(t){e.saveDialogVisible=t},close:e.onSaveDialogClose}},[a("el-form",{ref:"saveForm",attrs:{model:e.saveForm,"label-width":"120px",rules:e.saveRules}},[a("el-form-item",{attrs:{label:"流程类型",prop:"type"}},[a("el-select",{attrs:{filterable:"","allow-create":"",placeholder:"请选择流程类型"},model:{value:e.saveForm.type,callback:function(t){e.$set(e.saveForm,"type",t)},expression:"saveForm.type"}},e._l(e.typeOption,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),a("el-form-item",{attrs:{label:"流程名称",prop:"name"}},[a("el-input",{attrs:{placeholder:"请输入流程名称"},model:{value:e.saveForm.name,callback:function(t){e.$set(e.saveForm,"name",t)},expression:"saveForm.name"}})],1),a("el-form-item",{attrs:{label:"是否允许引用",prop:"canUse"}},[a("el-checkbox",{attrs:{"true-label":1,"false-label":0},model:{value:e.saveForm.canUse,callback:function(t){e.$set(e.saveForm,"canUse",t)},expression:"saveForm.canUse"}})],1)],1),a("span",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.onSaveDialogClose}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.onSaveAsDraft}},[e._v("保存为草稿")]),a("el-button",{attrs:{type:"primary"},on:{click:e.onSave}},[e._v("保存")])],1)],1)],1)},i=[],r=(a("a4d3"),a("e01a"),a("d28b"),a("99af"),a("4de4"),a("7db0"),a("c740"),a("4160"),a("5ded"),a("a434"),a("b0c0"),a("a9e3"),a("e439"),a("dbb4"),a("b64b"),a("d3b7"),a("ac1f"),a("3ca3"),a("1276"),a("159b"),a("ddb0"),a("284c")),o=a("bf2d"),s=(a("96cf"),a("2fa7")),c=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"toolbar"},[a("link",{attrs:{rel:"stylesheet",type:"text/css",href:"//at.alicdn.com/t/font_1581731_z26piaggta.css"}}),a("el-popconfirm",{attrs:{placement:"bottom-start",width:"160",title:"新建流程将丢失未保存数据，确定吗？",confirmButtonText:"好的",cancelButtonText:"取消"},on:{onConfirm:e.handleCreate,onCancel:function(t){e.popVisible=!1}},model:{value:e.popVisible,callback:function(t){e.popVisible=t},expression:"popVisible"}},[a("i",{staticClass:"command iconfont icon-create",attrs:{slot:"reference",title:"新建流程"},on:{click:function(t){e.popVisible=!0}},slot:"reference"})]),a("i",{staticClass:"command iconfont icon-save-as",staticStyle:{"margin-left":"3px"},attrs:{"data-command":"saveAs",title:"另存为"},on:{click:function(t){return e.handleSave("saveAs")}}}),a("i",{staticClass:"command iconfont icon-save",staticStyle:{"margin-left":"3px"},attrs:{"data-command":"save",title:"保存"},on:{click:function(t){return e.handleSave("save")}}}),a("span",{staticClass:"separator"}),a("i",{staticClass:"command iconfont icon-undo",class:e.undoList.length>0?"":"disable",attrs:{title:"撤销"},on:{click:e.handleUndo}}),a("i",{staticClass:"command iconfont icon-redo",class:e.redoList.length>0?"":"disable",attrs:{title:"重做"},on:{click:e.handleRedo}}),a("i",{staticClass:"command iconfont icon-delete",class:e.selectedItem?"":"disable",attrs:{"data-command":"delete",title:"删除"},on:{click:e.handleDelete}}),a("span",{staticClass:"separator"}),a("i",{staticClass:"command iconfont icon-zoom-in",attrs:{"data-command":"zoomIn",title:"放大"},on:{click:e.handleZoomIn}}),a("i",{staticClass:"command iconfont icon-zoom-out",attrs:{"data-command":"zoomOut",title:"缩小"},on:{click:e.handleZoomOut}}),a("i",{staticClass:"command iconfont icon-fit",attrs:{"data-command":"autoZoom",title:"适应画布"},on:{click:e.handleAutoZoom}}),a("i",{staticClass:"command iconfont icon-actual-size",attrs:{"data-command":"resetZoom",title:"实际尺寸"},on:{click:e.handleResetZoom}}),a("span",{staticClass:"separator"}),a("i",{staticClass:"command iconfont icon-group",class:e.multiSelect?"disable":"",attrs:{"data-command":"multiSelect",title:"多选"},on:{click:e.handleMuiltSelect}}),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.consoleData}},[e._v("控制台输出数据")]),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.handleRuntest}},[e._v("预跑")]),a("el-switch",{attrs:{"active-text":"边模式","inactive-text":"点模式","active-value":"edge","inactive-value":"node"},on:{change:e.changeMode},model:{value:e.mode,callback:function(t){e.mode=t},expression:"mode"}}),e.isEdit?a("el-button",{staticStyle:{float:"right","margin-right":"30px",padding:"4px 0"},attrs:{type:"text",icon:"el-icon-back"},on:{click:e.handleBack}},[e._v("返回")]):e._e()],1)},l=[],d=a("2b0e"),u=new d["default"],p=a("1bb5"),h=a.n(p),f=a("5010"),m={data:function(){return{page:{},graph:{},redoList:[],undoList:[],editor:null,command:null,selectedItem:null,multiSelect:!1,addGroup:!1,popVisible:!1,mode:""}},props:{isEdit:{type:Boolean,default:!1}},created:function(){this.init(),this.bindEvent()},watch:{selectedItem:function(e){e&&e.length>1?this.addGroup=!0:this.addGroup=!1}},methods:{init:function(){var e=this.$parent,t=e.editor,a=e.command;this.editor=t,this.command=a},bindEvent:function(){var e=this,t=this;u.$on("afterAddPage",(function(e){t.page=e,t.graph=t.page.graph})),u.$on("add",(function(t){e.redoList=t.redoList,e.undoList=t.undoList})),u.$on("update",(function(t){e.redoList=t.redoList,e.undoList=t.undoList})),u.$on("delete",(function(t){e.redoList=t.redoList,e.undoList=t.undoList})),u.$on("updateItem",(function(t){e.command.executeCommand("update",[t])})),u.$on("addItem",(function(t){e.command.executeCommand("add",[t])})),u.$on("nodeselectchange",(function(){var t;e.selectedItem=e.graph.findAllByState("node","selected"),e.selectedItem=(t=e.selectedItem).concat.apply(t,Object(r["a"])(e.graph.findAllByState("edge","selected")))})),u.$on("deleteItem",(function(){e.handleDelete()})),u.$on("muliteSelectEnd",(function(){e.multiSelect=!1,e.selectedItem=e.graph.findAllByState("node","selected")}))},handleUndo:function(){this.undoList.length>0&&this.command.undo()},handleRedo:function(){this.redoList.length>0&&this.command.redo()},handleDelete:function(){this.selectedItem.length>0&&(this.command.executeCommand("delete",this.selectedItem),this.selectedItem=null)},handleSave:function(e){this.$emit("save",this.graph.save(),e)},handleCreate:function(){this.graph.read({})},getFormatPadding:function(){return h.a.formatPadding(this.graph.get("fitViewPadding"))},getViewCenter:function(){var e=this.getFormatPadding(),t=this.graph,a=this.graph.get("width"),n=t.get("height");return{x:(a-e[2]-e[3])/2+e[3],y:(n-e[0]-e[2])/2+e[0]}},handleZoomIn:function(){var e=this.graph.getZoom();this.graph.zoomTo(e+.5,this.getViewCenter())},handleZoomOut:function(){var e=this.graph.getZoom();this.graph.zoomTo(e-.5,this.getViewCenter())},handleToBack:function(){var e=this;this.selectedItem&&this.selectedItem.length>0&&this.selectedItem.forEach((function(t){t.toBack(),e.graph.paint()}))},handleToFront:function(){var e=this;this.selectedItem&&this.selectedItem.length>0&&this.selectedItem.forEach((function(t){"edge"===t.getType()||t.toFront(),e.graph.paint()}))},handleAutoZoom:function(){this.graph.fitView(20)},handleResetZoom:function(){this.graph.zoomTo(1,this.getViewCenter())},handleMuiltSelect:function(){this.multiSelect=!0,this.graph.setMode("mulitSelect")},handleAddGroup:function(){},getPosition:function(e){var t,a,n,i,r=[];e.forEach((function(e){var t=e.getBBox();r.push(Object(f["a"])(t.x,t.y,t.width,t.height))})),r.forEach((function(e){"undefined"==typeof t&&(t=e.x1),"undefined"==typeof a&&(a=e.y1),"undefined"==typeof n&&(n=e.x2),"undefined"==typeof i&&(i=e.y2),t>e.x1&&(t=e.x1),a>e.y1&&(a=e.y1),n<e.x2&&(n=e.x2),i<e.y2&&(i=e.y2)}));var o=n-t,s=i-a,c=t+o/2,l=a+s/2,d="team"+Object(f["b"])(),u={id:d,width:o,height:s,x:c,y:l,shape:"teamNode"};this.command.executeCommand("add",u)},consoleData:function(){console.log(this.graph.save()),console.log(JSON.stringify(this.graph.save()))},handleRuntest:function(){this.$emit("test",this.graph.save())},changeMode:function(e){switch(e){case"node":this.graph.setMode("default");break;case"edge":this.graph.find("node",(function(e){var t=e.getContainer(),a=t.get("children")[0],n=t.findAll((function(e){return e._attrs.parent===a._attrs.id}));a.attr("cursor","default"),n.forEach((function(e){e.attr("cursor","default")}))})),this.graph.setMode("addEdge");break;default:break}},handleBack:function(){this.$router.go(-1)}}},g=m,v=(a("dba7"),a("2877")),y=Object(v["a"])(g,c,l,!1,null,"0ca2985f",null),b=y.exports,x=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"itempannel"},[a("Item")],1)},k=[],w=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ul",e._l(e.list,(function(t,n){return a("li",{key:n,staticClass:"getItem",attrs:{"data-shape":t.shape,"data-type":t.type,"data-size":t.size,draggable:""},on:{dragstart:function(a){return e.handleDragstart(a,t)},dragend:function(a){return e.handleDragEnd(a,t)}}},[a("span",{staticClass:"pannel-type-icon",style:{background:"url("+t.image+")"}}),e._v(" "+e._s(t.name)+" ")])})),0)},D=[],C=(a("39cf"),a("391b")),O=a.n(C),I=a("b8f1"),_=a.n(I),S=a("1526"),j=a.n(S),N=[{name:"开始节点",label:"开始",size:"170*34",type:"node",x:0,y:0,shape:"customNode",color:"#fa8c16",image:O.a,inPoints:[[0,.5]],outPoints:[[1,.5]],mType:"startNode",nodeKind:4},{name:"结束节点",label:"结束",size:"170*34",type:"node",x:0,y:0,shape:"customNode",color:"#f5222d",image:_.a,inPoints:[[0,.5]],outPoints:[[1,.5]],mType:"endNode",nodeKind:5},{name:"循环控制节点",label:"循环控制",size:"170*34",type:"node",x:0,y:0,shape:"customNode",color:"#7cba59",image:j.a,inPoints:[[1,.5]],outPoints:[[0,.5]],mType:"cycleNode",nodeKind:3,attr:{cycleTime:0,delayTime:0},attrName:[{name:"循环次数",attribute:"cycleTime",type:"inputNumber",min:0,required:!0,clientType:"sell"},{name:"延迟时间",attribute:"delayTime",type:"inputNumber",min:0,required:!0,clientType:"sell"}]},{name:"流程节点",label:"流程节点",size:"170*34",type:"node",x:0,y:0,shape:"customNode",color:"#1890ff",image:"https://gw.alipayobjects.com/zos/rmsportal/czNEJAmyDpclFaSucYWB.svg",inPoints:[[0,.5]],outPoints:[[1,.5]],mType:"wfdNode",nodeKind:0,attr:{bindForm:"",time:0,inChargeGroupID:"",inChargeUserID:"",roomGroups:[],needDevice:!1,needAuditing:!1},attrName:[{name:"绑定表单",attribute:"bindForm",type:"select",required:!0,clientType:"sell",options:[]},{name:"节点负责人职位",attribute:"inChargeGroupID",type:"select",required:!0,clientType:"sell",options:[]},{name:"工作人",attribute:"inChargeUserID",type:"select",clientType:"sell",options:[]},{name:"聊天室用户组",attribute:"roomGroups",type:"multiSelect",required:!0,clientType:"sell"},{name:"时间限制（单位：分钟）",attribute:"time",type:"inputNumber",min:0,required:!0,clientType:"sell"},{name:"是否需要机器",attribute:"needDevice",type:"singleCheck",required:!0,clientType:"sell"},{name:"是否需要审核",attribute:"needAuditing",type:"singleCheck",required:!0,clientType:"sell"}]},{name:"嵌套流程节点",label:"嵌套流程节点",size:"170*34",type:"node",x:0,y:0,shape:"customNode",color:"#1890ff",image:"https://gw.alipayobjects.com/zos/rmsportal/czNEJAmyDpclFaSucYWB.svg",inPoints:[[0,.5]],outPoints:[[1,.5]],mType:"embedNode",attr:{processID:"",time:0},attrName:[{name:"嵌套流程",attribute:"processID",clientType:"sell",type:"select",options:[]}]},{name:"同步节点",label:"同步节点",size:"170*34",type:"node",x:0,y:0,shape:"customNode",color:"#f5222d",image:_.a,inPoints:[[0,.5]],outPoints:[[1,.5]],mType:"syncNode"},{name:"并发节点",label:"并发节点",size:"170*34",type:"node",x:0,y:0,shape:"customNode",color:"#f5222d",image:_.a,inPoints:[[0,.5]],outPoints:[[1,.5]],mType:"concurrencyNode"}],P=a("ed08"),L={data:function(){return{page:null,command:null,offsetX:0,offsetY:0,list:N}},created:function(){this.bindEvent()},methods:{handleDragstart:function(e){this.offsetX=e.offsetX,this.offsetY=e.offsetY},handleDragEnd:function(e,t){var a=t;if("startNode"===t.mType||"endNode"===t.mType||"cycleNode"===t.mType){var n=this.page.graph.save().nodes;for(var i in n)if(n[i].mType===t.mType)return void this.$notify.error({title:"错误",message:t.name+" 在流程图中只存在一个"})}if(this.page){var r=this.page.graph;if("syncNode"===t.mType){var o,s,c={},l={};c=Object(P["a"])(a),c.offsetX=this.offsetX,c.offsetY=this.offsetY;var d=r.getPointByClient(e.x,e.y);c.x=d.x,c.y=d.y,c.size=[],c.size=a.size.split("*"),c.type="node",c.name="同步头节点",c.label="同步头节点",l=Object(P["a"])(c),c.nodeKind=1,c.attr={bindForm:"",time:0,inChargeGroupID:"",inChargeUserID:"",roomGroups:[],needDevice:!1,needAuditing:!1},c.attrName=[{name:"绑定表单",attribute:"bindForm",type:"select",clientType:"sell",options:[]},{name:"节点负责人职位",attribute:"inChargeGroupID",type:"select",clientType:"sell",options:[]},{name:"工作人",attribute:"inChargeUserID",type:"select",clientType:"sell",options:[]},{name:"聊天室用户组",attribute:"roomGroups",type:"multiSelect",clientType:"sell"},{name:"时间限制（单位：分钟）",attribute:"time",type:"inputNumber",min:0,clientType:"sell"},{name:"是否需要机器",attribute:"needDevice",type:"singleCheck",required:!0,clientType:"sell"},{name:"是否需要审核",attribute:"needAuditing",type:"singleCheck",required:!0,clientType:"sell"}],o=this.command.executeCommand("add",[c]),l.offsetY+=100,l.y+=100,l.name="同步尾节点",l.label="同步尾节点",l.syncBeginID=o,l.nodeKind=2,s=this.command.executeCommand("add",[l]);var u=this.page.graph.findById(o),p={syncEndID:s};this.page.graph.updateItem(u,p)}else if("concurrencyNode"===t.mType){var h,f,m={},g={};m=Object(P["a"])(a),m.offsetX=this.offsetX,m.offsetY=this.offsetY;var v=r.getPointByClient(e.x,e.y);m.x=v.x,m.y=v.y,m.size=[],m.size=a.size.split("*"),m.type="node",m.name="并发头节点",m.label="并发头节点",g=Object(P["a"])(m),m.nodeKind=0,m.attr={bindForm:"",time:0,inChargeGroupID:"",inChargeUserID:"",roomGroups:[],needDevice:!1,needAuditing:!1},m.attrName=[{name:"绑定表单",attribute:"bindForm",type:"select",clientType:"sell",options:[]},{name:"节点负责人职位",attribute:"inChargeGroupID",type:"select",clientType:"sell",options:[]},{name:"工作人",attribute:"inChargeUserID",type:"select",clientType:"sell",options:[]},{name:"聊天室用户组",attribute:"roomGroups",type:"multiSelect",clientType:"sell"},{name:"时间限制（单位：分钟）",attribute:"time",type:"inputNumber",min:0,clientType:"sell"},{name:"是否需要机器",attribute:"needDevice",type:"singleCheck",required:!0,clientType:"sell"},{name:"是否需要审核",attribute:"needAuditing",type:"singleCheck",required:!0,clientType:"sell"}],h=this.command.executeCommand("add",[m]),g.offsetY+=100,g.y+=100,g.name="并发尾节点",g.label="并发尾节点",g.concurrencyBeginID=h,g.nodeKind=6,f=this.command.executeCommand("add",[g]);var y=this.page.graph.findById(h),b={concurrencyEndID:f};this.page.graph.updateItem(y,b)}else{var x=Object(P["a"])(t);x.offsetX=this.offsetX,x.offsetY=this.offsetY;var k=r.getPointByClient(e.x,e.y);x.x=k.x,x.y=k.y,x.size=t.size.split("*"),x.type="node",this.command.executeCommand("add",[x])}}},bindEvent:function(){var e=this;u.$on("afterAddPage",(function(t){e.page=t,e.command=t.command}))}}},F=L,E=(a("3d6c"),Object(v["a"])(F,w,D,!1,null,"206af99a",null)),T=E.exports,$={components:{Item:T},data:function(){return{page:null,command:null}},created:function(){this.bindEvent()},methods:{bindEvent:function(){var e=this;u.$on("afterAddPage",(function(t){e.page=t}))}}},B=$,M=(a("c48c"),Object(v["a"])(B,x,k,!1,null,"72ab3945",null)),A=M.exports,U=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"detailpannel"},[a("div",["node-selected"===e.status?a("div",{staticClass:"pannel",attrs:{id:"node_detailpannel"}},[a("div",{staticClass:"pannel-title"},[e._v("节点详情")]),a("div",{staticClass:"block-container"},[a("el-row",{attrs:{gutter:10}},[a("div",{staticClass:"attr-container"},[a("el-col",{attrs:{span:9}},[e._v("节点ID：")]),a("el-col",{attrs:{span:15}},[e._v(" "+e._s(e.node.id)+" ")])],1),a("div",{staticClass:"attr-container"},[a("el-col",{attrs:{span:9}},[a("p",[e._v("名称")])]),a("el-col",{attrs:{span:15}},[a("el-input",{attrs:{disabled:"startNode"===e.node.mType||"endNode"===e.node.mType||"cycleNode"===e.node.mType||6===e.node.nodeKind||2===e.node.nodeKind},on:{change:e.handleChangeName},model:{value:e.node.name,callback:function(t){e.$set(e.node,"name",t)},expression:"node.name"}})],1)],1),e._l(e.node.attrName,(function(t){return a("div",{key:t.name,staticClass:"attr-container"},["sell"===t.clientType?a("div",[a("el-col",{attrs:{span:9}},[t.required?a("p",{staticStyle:{color:"#f56c6c","margin-right":"4px"}},[e._v("*")]):e._e(),a("p",[e._v(e._s(t.name))])]),a("el-col",{attrs:{span:15}},["input"===t.type&&"sell"===t.clientType?a("el-input",{on:{change:function(a){var n=arguments.length,i=Array(n);while(n--)i[n]=arguments[n];return e.handleChangeInput.apply(void 0,i.concat([t.attribute]))}},model:{value:e.node.attr[t.attribute],callback:function(a){e.$set(e.node.attr,t.attribute,a)},expression:"node.attr[attrName.attribute]"}}):e._e(),"inputNumber"===t.type&&"sell"===t.clientType?a("el-input-number",{attrs:{min:t.min,max:t.max,precision:0},on:{change:function(a){var n=arguments.length,i=Array(n);while(n--)i[n]=arguments[n];return e.handleChangeNumber.apply(void 0,i.concat([t.attribute]))}},model:{value:e.node.attr[t.attribute],callback:function(a){e.$set(e.node.attr,t.attribute,a)},expression:"node.attr[attrName.attribute]"}}):e._e(),"select"===t.type&&"sell"===t.clientType?a("el-select",{attrs:{placeholder:"请选择",filterable:"",clearable:""},on:{change:function(a){var n=arguments.length,i=Array(n);while(n--)i[n]=arguments[n];return e.handleChangeSelect.apply(void 0,i.concat([t.attribute]))}},model:{value:e.node.attr[t.attribute],callback:function(a){e.$set(e.node.attr,t.attribute,a)},expression:"node.attr[attrName.attribute]"}},e._l(t.options,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1):e._e(),"multiSelect"===t.type&&"sell"===t.clientType?a("el-select",{attrs:{placeholder:"请选择",multiple:"",filterable:""},model:{value:e.node.attr[t.attribute],callback:function(a){e.$set(e.node.attr,t.attribute,a)},expression:"node.attr[attrName.attribute]"}},e._l(t.options,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1):e._e(),"singleCheck"===t.type&&"sell"===t.clientType?a("el-checkbox",{staticStyle:{"line-height":"40px"},model:{value:e.node.attr[t.attribute],callback:function(a){e.$set(e.node.attr,t.attribute,a)},expression:"node.attr[attrName.attribute]"}}):e._e()],1)],1):e._e()])}))],2)],1)]):e._e(),"canvas-selected"===e.status?a("div",{staticClass:"pannel",attrs:{id:"canvas_detailpannel"}},[a("div",{staticClass:"pannel-title"},[e._v("画布")]),a("div",{staticClass:"block-container"},[a("el-checkbox",{on:{change:e.changeGridState},model:{value:e.showGrid,callback:function(t){e.showGrid=t},expression:"showGrid"}},[e._v("网格对齐")])],1)]):e._e()])])},q=[],z=(a("caad"),a("2532"),a("5319"),a("3820")),G=a.n(z),R=a("622a"),V={data:function(){return{status:"canvas-selected",showGrid:!1,page:{},graph:{},item:{},node:{},grid:null,formList:[],userList:[],filterUserList:[],userGroupList:[],processList:[]}},created:function(){this.getUserList(),this.getFormList(),this.getUserGroupList(),this.getProcessList(),this.init(),this.bindEvent()},methods:{init:function(){},bindEvent:function(){var e=this,t=this;u.$on("afterAddPage",(function(a){t.page=a,t.graph=t.page.graph,u.$on("nodeselectchange",(function(a){if(!0===a.select&&"node"===a.target.getType()){t.status="node-selected";var n=Object(P["a"])(a.target.getModel());for(var i in n.attrName)switch(n.attrName[i].attribute){case"bindForm":n.attrName[i].options=e.formList;break;case"inChargeGroupID":n.attrName[i].options=e.userGroupList;break;case"roomGroups":n.attrName[i].options=e.userGroupList;break;case"processID":n.attrName[i].options=e.filterCanUse(e.processList);break}e.graph.updateItem(a.target,n);var r=e.graph.findById(n.id);t.item=r,t.node=r.getModel()}else t.status="canvas-selected",t.item=null,t.node=null})),u.$on("detailPanelReset",(function(){t.status="canvas-selected",t.item=null,t.node=null}))}))},handleChangeName:function(e){var t=e.replace(/[\u0391-\uFFE5]/g,"aa").length,a={name:e,label:e};t>=14&&(a.label=e.substr(0,7)+"..."),this.graph.update(this.item,a)},handleChangeColor:function(e){var t={color:e};this.graph.update(this.item,t)},handleChangeInput:function(e,t){var a={attr:{}};a.attr[t]=e,this.graph.update(this.item,a)},handleChangeNumber:function(e,t,a){var n={attr:{}};n.attr[a]=e,this.graph.update(this.item,n)},handleChangeSelect:function(e,t){if("inChargeGroupID"===t){for(var a in this.node.attr["roomGroups"])this.node.attr["roomGroups"][a]!==e&&this.node.attr["roomGroups"].splice(a,1);this.node.attr["roomGroups"].includes(e)||this.node.attr["roomGroups"].push(e),this.handleFilterUserList(e)}},changeGridState:function(e){e?(this.grid=new G.a,this.graph.addPlugin(this.grid)):this.graph.removePlugin(this.grid)},getFormList:function(){var e=this;this.axios.post(R["b"].getFormListByUser).then((function(t){if(1===t.data.resultCode)for(var a in t.data.objData){var n={};n.value=t.data.objData[a].id,n.label=t.data.objData[a].name,e.formList.push(n)}})).catch((function(t){e.$message({type:"error",message:t.response.data.message})}))},getUserList:function(){var e=this;this.axios.post(R["d"].getSonUsers).then((function(t){1===t.data.resultCode&&(e.userList=t.data.objData)})).catch((function(t){e.$message({type:"error",message:t.response.data.message})}))},getUserGroupList:function(){var e=this;this.axios.post(R["d"].getUserGroups).then((function(t){if(1===t.data.resultCode)for(var a in t.data.objData){var n={};n.value=t.data.objData[a].groupID,n.label=t.data.objData[a].groupName,e.userGroupList.push(n)}})).catch((function(t){e.$message({type:"error",message:t.response.data.message})}))},getProcessList:function(){var e=this;this.axios.post(R["a"].getProcessListByUser).then((function(t){if(1===t.data.resultCode)for(var a in t.data.objData){var n={};n.value=t.data.objData[a].id,n.label=t.data.objData[a].name,n.canUse=t.data.objData[a].canUse,e.processList.push(n)}})).catch((function(t){e.$message({type:"error",message:t.response.data.message})}))},filterCanUse:function(e){var t=[],a=!0,n=!1,i=void 0;try{for(var r,o=e[Symbol.iterator]();!(a=(r=o.next()).done);a=!0){var s=r.value;console.log(s),1===s.canUse&&t.push(s)}}catch(c){n=!0,i=c}finally{try{a||null==o.return||o.return()}finally{if(n)throw i}}return t},handleFilterUserList:function(e){this.filterUserList=[];var t=!0,a=!1,n=void 0;try{for(var i,r=this.userList[Symbol.iterator]();!(t=(i=r.next()).done);t=!0){var o=i.value;if(o.userGroupID.includes(e)){var s={};s.value=o.userID,s.label=o.userName,this.filterUserList.push(s)}}}catch(p){a=!0,n=p}finally{try{t||null==r.return||r.return()}finally{if(a)throw n}}this.node.attr.inChargeUserID="";var c=Object(P["a"])(this.node);for(var l in c.attrName)"inChargeUserID"===c.attrName[l].attribute&&(c.attrName[l].options=this.filterUserList);var d=this.graph.findById(c.id);this.graph.updateItem(d,c);var u=this.graph.findById(c.id);this.item=u,this.node=u.getModel()}}},Y=V,X=(a("9be8"),Object(v["a"])(Y,U,q,!1,null,"901ac26c",null)),J=X.exports,K=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"navigator"}},[a("div",{staticClass:"pannel-title"},[e._v("导航器")]),a("div",{ref:"minimap",staticClass:"minimap",attrs:{id:"minimap"}})])},H=[],Z=a("027f"),W=a.n(Z);function Q(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function ee(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Q(a,!0).forEach((function(t){Object(s["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Q(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var te={data:function(){return{minimap:null,graph:null}},created:function(){this.bindEvent()},mounted:function(){var e=this;this.$nextTick((function(){e.initMinmap()}))},methods:{initMinmap:function(){var e={container:"minimap"};this.minimap=new W.a(ee({},e))},bindEvent:function(){var e=this;u.$on("afterAddPage",(function(t){e.graph=t.graph,e.bindPage()}))},bindPage:function(){this.minimap&&this.graph&&this.graph.addPlugin(this.minimap)}}},ae=te,ne=(a("22b2"),Object(v["a"])(ae,K,H,!1,null,"211c3e31",null)),ie=ne.exports,re=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page"},[a("div",{ref:"mountNode",staticClass:"graph-container",staticStyle:{position:"relative"},attrs:{id:e.pageId}})])},oe=[],se=a("07cd"),ce=a.n(se),le={getEvents:function(){return{"node:mouseover":"onMouseover","node:mouseleave":"onMouseleave","node:mousedown":"onMousedown"}},onMouseover:function(e){var t=this,a=e.item,n=t.graph,i=a.getContainer();(e.target._attrs.isOutPointOut||e.target._attrs.isOutPoint)&&(i.find((function(t){(t._attrs.isInPoint||t._attrs.isOutPoint)&&t.attr("fill","#fff"),t._attrs.isOutPoint&&t._attrs.id===e.target._attrs.parent&&i.find((function(e){}))})),this.graph.paint()),a.hasState("selected")||(t.shouldUpdate.call(t,e)&&n.setItemState(a,"hover",!0),n.paint())},onMouseleave:function(e){var t=this,a=e.item,n=t.graph,i=a.getContainer();i.find((function(e){(e._attrs.isInPoint||e._attrs.isOutPoint)&&e.attr("fill","#fff")})),t.shouldUpdate.call(t,e)&&(a.hasState("selected")||n.setItemState(a,"hover",!1)),n.paint()},onMousedown:function(e){"addEdge"!==self.graph.getCurrentMode()&&this.graph.setMode("moveNode")}},de=a("56d7"),ue=null,pe={getEvents:function(){return{"node:click":"onMouseClick"}},onMouseClick:function(e){var t=self.graph,a=e.item;if(ue){if(this.checkCondition(a,t)){if(ue._cfg.model.syncEndID){var n=t.findById(a._cfg.id),i={syncBeginID:ue._cfg.id};t.update(n,i)}else if(ue._cfg.model.syncBeginID&&"syncNode"!==ue._cfg.model.mType){var r=this.graph.findById(a._cfg.id),o={syncBeginID:ue._cfg.model.syncBeginID};t.update(r,o)}else if(ue._cfg.model.concurrencyEndID){var s=t.findById(a._cfg.id),c={concurrencyBeginID:ue._cfg.id};t.update(s,c)}else if(ue._cfg.model.concurrencyBeginID&&"concurrencyNode"!==ue._cfg.model.mType){var l=this.graph.findById(a._cfg.id),d={concurrencyBeginID:ue._cfg.model.concurrencyBeginID};t.update(l,d)}if("cycleNode"===ue._cfg.model.mType){var p=this.graph.findById(ue._cfg.id),h={loopBeginNodeID:a._cfg.id};t.update(p,h)}var m={id:"edge"+Object(f["b"])(),source:ue,target:a,sourceId:ue._cfg.id,targetId:a._cfg.id,shape:"customEdge",type:"edge"};"cycleNode"===ue._cfg.model.mType?m.start={x:0,y:-17}:"cycleNode"===a._cfg.model.mType&&(m.end={x:0,y:17}),u.$emit("addItem",m),t.setItemState(ue,"addEdgeHover",!1),ue=null,this.graph.paint()}else if(ue){var g={id:"edge"+Object(f["b"])(),source:ue,target:a,sourceId:ue._cfg.id,targetId:a._cfg.id,shape:"customEdge",type:"edge",warn:!0};"cycleNode"===ue._cfg.model.mType?g.start={x:0,y:-17}:"cycleNode"===a._cfg.model.mType&&(g.end={x:0,y:17}),u.$emit("addItem",g),t.setItemState(ue,"addEdgeHover",!1),ue=null,this.graph.paint()}}else ue=a,t.setItemState(ue,"addEdgeHover",!0),t.paint()},checkCondition:function(e,t){if(ue._cfg.id===e._cfg.id)return de["default"].$notify.error({title:"错误",message:"起始点与结束点不可以是同一个节点"}),t.setItemState(ue,"addEdgeHover",!1),ue=null,!1;if(this.graph.find("edge",(function(t){return t.getSource()._cfg.id===ue._cfg.id&&t.getTarget()._cfg.id===e._cfg.id})))return de["default"].$notify.error({title:"错误",message:"两个节点之间已经存在一条边"}),t.setItemState(ue,"addEdgeHover",!1),ue=null,!1;if("syncNode"===e._cfg.model.mType&&e._cfg.model.syncBeginID){if(!ue._cfg.model.syncBeginID)return de["default"].$notify.warning({title:"提示",message:"请检查节点是否为该同步流程中节点"}),!1;if(ue._cfg.model.syncBeginID!==e._cfg.model.syncBeginID)return de["default"].$notify.warning({title:"提示",message:"请检查节点是否为该同步流程中节点"}),!1}if("concurrencyNode"===e._cfg.model.mType&&e._cfg.model.concurrencyBeginID){if(!ue._cfg.model.concurrencyBeginID)return de["default"].$notify.warning({title:"提示",message:"请检查节点是否为该并步流程中节点"}),!1;if(ue._cfg.model.concurrencyBeginID!==e._cfg.model.concurrencyBeginID)return de["default"].$notify.warning({title:"提示",message:"请检查节点是否为该并发流程中节点"}),!1}if("wfdNode"===e._cfg.model.mType&&e._cfg.model.syncBeginID){if(!ue._cfg.model.syncBeginID)return de["default"].$notify.warning({title:"提示",message:"请检查节点是否为该同步流程中节点"}),!1;if(ue._cfg.model.syncBeginID!==e._cfg.model.syncBeginID)return de["default"].$notify.warning({title:"提示",message:"请检查节点是否为该同步流程中节点"}),!1}if("wfdNode"===e._cfg.model.mType&&e._cfg.model.concurrencyBeginID){if(!ue._cfg.model.concurrencyBeginID)return de["default"].$notify.warning({title:"提示",message:"请检查节点是否为该并步流程中节点"}),!1;if(ue._cfg.model.concurrencyBeginID!==e._cfg.model.concurrencyBeginID)return de["default"].$notify.warning({title:"提示",message:"请检查节点是否为该并发流程中节点"}),!1}return"cycleNode"!==ue._cfg.model.mType||"endNode"!==e._cfg.model.mType||(de["default"].$notify.error({title:"错误",message:"循环节点不可接入结束节点"}),t.setItemState(ue,"addEdgeHover",!1),ue=null,!1)}},he=a("2ef0");function fe(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function me(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?fe(a,!0).forEach((function(t){Object(s["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):fe(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var ge={fill:"#F3F9FF",fillOpacity:.5,stroke:"#1890FF",strokeOpacity:.9,lineDash:[5,5]},ve=document.body,ye={isDrag:!1,nodeEvent:null,getDefaultCfg:function(){return{updateEdge:!0,delegate:!0,delegateStyle:{}}},getEvents:function(){return{"node:mousedown":"onMousedown",mousemove:"onMousemove",mouseup:"onMouseup","canvas:mouseleave":"onOutOfRange"}},getNode:function(e){var t=this;if(this.shouldBegin.call(this,e)){this.isDrag=!0,this.nodeEvent=e;var a=e.item,n=this.graph;this.targets=[];var i=n.findAllByState("node","selected"),r=a.get("id"),o=i.filter((function(e){var t=e.get("id");return r===t}));0===o.length?this.target=a:i.length>1?i.forEach((function(e){t.targets.push(e)})):this.targets.push(a),this.origin={x:e.x,y:e.y},this.point={},this.originPoint={}}},onMousemove:function(e){this.origin||this.getNode(e),this.isDrag&&this.get("shouldUpdate").call(this,e)&&(this.targets&&this.targets.length>0?this._updateDelegate(e,this.nodeEvent):this._update(this.target,e,this.nodeEvent,!0))},onMouseup:function(e){var t=this;if(this.shape&&(this.shape.remove(),this.shape=null),this.target){var a=this.target.get("delegateShape");a&&(a.remove(),this.target.set("delegateShape",null))}if(this.targets&&this.targets.length>0)this.targets.forEach((function(a){return t._update(a,e)}));else if(this.target){var n=this.origin,i=this.target.get("model"),r=this.target.get("id");this.point[r]||(this.point[r]={x:i.x,y:i.y});var o=e.x-n.x+this.point[r].x,s=e.y-n.y+this.point[r].y,c={};c.item=this.target,c.oldModel=this.origin,c.newModel={x:o,y:s},u.$emit("updateItem",c)}this.point={},this.origin=null,this.originPoint={},this.targets&&(this.targets.length=0),this.target=null;var l=this.fn;l&&(ve.removeEventListener("mouseup",l,!1),this.fn=null),this.isDrag=!1,this.nodeEvent=null,this.graph.setMode("default")},onOutOfRange:function(e){var t=this;if(this.origin){var a=t.graph.get("canvas").get("el"),n=function(n){n.target!==a&&t.onDragEnd(e)};this.fn=n,ve.addEventListener("mouseup",n,!1)}},_update:function(e,t,a,n){var i=this.origin,r=e.get("model"),o=e.get("id");this.point[o]||(this.point[o]={x:r.x,y:r.y});var s=t.x-i.x+this.point[o].x,c=t.y-i.y+this.point[o].y;if(n)this._updateDelegate(t,a,s,c);else{var l={x:s,y:c};this.get("updateEdge")?this.graph.updateItem(e,l):(e.updatePosition(l),this.graph.paint())}},_updateDelegate:function(e,t,a,n){var i=t.item.get("keyShape").getBBox();if(!this.shape){var r=this.graph.get("group"),o=Object(he["merge"])({},ge,this.delegateStyle);if(this.targets.length>0){var s=this.calculationGroupPosition(),c=s.x,l=s.y,d=s.width,u=s.height,p=s.minX,h=s.minY;this.originPoint={x:c,y:l,width:d,height:u,minX:p,minY:h},this.shape=r.addShape("rect",{attrs:me({width:d,height:u,x:c,y:l},o)})}else this.target&&(this.shape=r.addShape("rect",{attrs:me({width:i.width,height:i.height,x:a-i.width/2,y:n-i.height/2},o)}),this.target.set("delegateShape",this.shape));this.shape.set("capture",!1)}if(this.targets.length>0){var f=e.x-this.origin.x+this.originPoint.minX,m=e.y-this.origin.y+this.originPoint.minY;this.shape.attr({x:f,y:m})}else this.target&&this.shape.attr({x:a-i.width/2,y:n-i.height/2});this.graph.paint()},calculationGroupPosition:function(){var e=this.graph,t=e.findAllByState("node","selected"),a=[],n=[],i=[],r=[],o=!0,s=!1,c=void 0;try{for(var l,d=t[Symbol.iterator]();!(o=(l=d.next()).done);o=!0){var u=l.value,p=Object(he["isString"])(u)?e.findById(u):u,h=p.getBBox(),f=h.minX,m=h.minY,g=h.maxX,v=h.maxY;a.push(f),i.push(m),n.push(g),r.push(v)}}catch(I){s=!0,c=I}finally{try{o||null==d.return||d.return()}finally{if(s)throw c}}var y=Math.floor(Math.min.apply(Math,a)),b=Math.floor(Math.max.apply(Math,n)),x=Math.floor(Math.min.apply(Math,i)),k=Math.floor(Math.max.apply(Math,r)),w=y-20,D=x+10,C=b-y,O=k-x;return{x:w,y:D,width:C,height:O,minX:y,minY:x}}},be={getDefaultCfg:function(){return{multiple:!0,keyCode:16}},getEvents:function(){return{"node:click":"onClick","canvas:click":"onCanvasClick","canvas:mouseover":"onCanvasMouseover",keyup:"onKeyUp",keydown:"onKeyDown"}},onClick:function(e){var t=this,a=e.item,n=t.graph,i=n.get("autoPaint");n.setAutoPaint(!1);var r=n.findAllByState("edge","selected");if(h.a.each(r,(function(e){n.setItemState(e,"selected",!1)})),!t.keydown||!t.multiple){var o=n.findAllByState("node","selected");h.a.each(o,(function(e){e!==a&&n.setItemState(e,"selected",!1)}))}a.hasState("selected")?(t.shouldUpdate.call(t,e)&&n.setItemState(a,"selected",!1),u.$emit("nodeselectchange",{target:a,select:!1})):(t.shouldUpdate.call(t,e)&&n.setItemState(a,"selected",!0),u.$emit("nodeselectchange",{target:a,select:!0})),n.setAutoPaint(i),n.paint()},onCanvasClick:function(){var e=this.graph,t=e.get("autoPaint");e.setAutoPaint(!1);var a=e.findAllByState("node","selected");h.a.each(a,(function(t){e.setItemState(t,"selected",!1),u.$emit("nodeselectchange",{target:t,select:!1})}));var n=e.findAllByState("edge","selected");h.a.each(n,(function(t){e.setItemState(t,"selected",!1),u.$emit("nodeselectchange",{target:t,select:!1})})),e.paint(),e.setAutoPaint(t)},onCanvasMouseover:function(){var e=this.graph;e.paint()},onKeyDown:function(e){var t=e.keyCode||e.which;t===this.keyCode?this.keydown=!0:this.keydown=!1},onKeyUp:function(){this.keydown=!1}},xe={getEvents:function(){return{"edge:mouseover":"onMouseover","edge:mouseleave":"onMouseleave","edge:click":"onClick"}},onMouseover:function(e){var t=this,a=e.item,n=t.graph;a.hasState("selected")||(t.shouldUpdate.call(t,e)&&n.setItemState(a,"hover",!0),n.paint())},onMouseleave:function(e){var t=this,a=e.item,n=t.graph,i=a.getContainer();i.find((function(e){(e._attrs.isInPoint||e._attrs.isOutPoint)&&e.attr("fill","#fff")})),t.shouldUpdate.call(t,e)&&(a.hasState("selected")||n.setItemState(a,"hover",!1)),n.paint()},onClick:function(e){var t=this,a=e.item,n=t.graph,i=n.get("autoPaint");n.setAutoPaint(!1);var r=n.findAllByState("node","selected");if(h.a.each(r,(function(e){n.setItemState(e,"selected",!1)})),!t.keydown||!t.multiple){var o=n.findAllByState("edge","selected");h.a.each(o,(function(e){e!==a&&n.setItemState(e,"selected",!1)}))}a.hasState("selected")?(t.shouldUpdate.call(t,e)&&n.setItemState(a,"selected",!1),u.$emit("nodeselectchange",{target:a,select:!1})):(t.shouldUpdate.call(t,e)&&n.setItemState(a,"selected",!0),u.$emit("nodeselectchange",{target:a,select:!0})),n.setAutoPaint(i),n.paint()}},ke={getDefaultCfg:function(){return{deleteKeyCode:46}},getEvents:function(){return{keyup:"onKeyUp",keydown:"onKeyDown"}},onKeyDown:function(e){var t=e.keyCode||e.which;switch(t){case this.deleteKeyCode:u.$emit("deleteItem");break}},onKeyUp:function(){this.keydown=!1}},we={version:"0.0.1-beat",rootContainerClassName:"root-container",nodeContainerClassName:"node-container",edgeContainerClassName:"edge-container",groupContainerClassName:"group-container",defaultNode:{shape:"circle",style:{fill:"#fff"},size:40,color:"#333"},defaultEdge:{shape:"line",style:{},size:1,color:"#333"},nodeLabel:{style:{fill:"#595959",textAlign:"center",textBaseline:"middle"},offset:5},edgeLabel:{style:{fill:"#595959",textAlign:"center",textBaseline:"middle"}},nodeStateStyle:{active:{fillOpacity:.8},selected:{lineWidth:2}},edgeStateStyle:{active:{strokeOpacity:.8},selected:{lineWidth:2}},loopPosition:"top",delegateStyle:{fill:"#F3F9FF",fillOpacity:.5,stroke:"#1890FF",strokeOpacity:.9,lineDash:[5,5]}};function De(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Ce(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?De(a,!0).forEach((function(t){Object(s["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):De(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var Oe={getDefaultCfg:function(){return{}},getEvents:function(){return{"canvas:mouseenter":"onCanvasMouseenter","canvas:mousedown":"onCanvasMousedown",mousemove:"onMousemove",mouseup:"onMouseup"}},onCanvasMouseenter:function(){var e=document.getElementById("graph-container").children[0];e.style.cursor="crosshair"},onCanvasMousedown:function(e){var t=we.delegateStyle,a=0,n=0,i=e.x,r=e.y,o=this.graph.get("group");this.shape=o.addShape("rect",{attrs:Ce({id:"rect"+Object(f["b"])(),width:a,height:n,x:i,y:r},t)})},onMousemove:function(e){if(this.shape){var t=e.x-this.shape._attrs.x,a=e.y-this.shape._attrs.y;this.shape.attr({width:t,height:a}),this.graph.paint()}},onMouseup:function(){var e=this,t=document.getElementById("graph-container").children[0];t.style.cursor="default";var a=this.graph.findAllByState("node","selected");h.a.each(a,(function(t){e.graph.setItemState(t,"selected",!1),u.$emit("nodeselectchange",{target:t,select:!1})})),this.shape&&(this.addTeam(),this.shape.remove(),this.shape=null),this.graph.paint(),u.$emit("muliteSelectEnd"),this.graph.setMode("default")},addTeam:function(){var e=this,t=this.shape._attrs,a=t.x,n=t.y,i=t.width,r=t.height,o=Object(f["a"])(a,n,i,r),s=o.x1,c=o.y1,l=o.x2,d=o.y2;this.graph.findAll("node",(function(t){var a=t.getBBox(),n=a.x,i=a.y,r=a.width,o=a.height,u=Object(f["a"])(n,i,r,o);l>=u.x1&&u.x1>=s&&l>=u.x2&&u.x2>=s&&d>=u.y1&&u.y1>=c&&d>=u.y2&&u.y2>=c&&e.graph.setItemState(t,"selected",!0)}))}},Ie={getEvents:function(){return{"node:contextmenu":"onContextmenu",mousedown:"onMousedown","canvas:click":"onCanvasClick"}},onContextmenu:function(e){u.$emit("contextmenuClick",e)},onMousedown:function(e){u.$emit("mousedown",e)},onCanvasClick:function(e){u.$emit("canvasClick",e)}},_e=(a("4e82"),function(e){var t=e.Util,a=t.mix,n=t.each,i=t.vec2;e.registerBehavior("itemAlign",{getDefaultCfg:function(){return{alignLineStyle:{stroke:"#FA8C16",lineWidth:1},tolerance:5,_alignLines:[]}},getEvents:function(){return{"node:drag":"onDrag","node:dragend":"onDragEnd"}},onDrag:function(e){var t=e.item.getKeyShape();this._clearAlignLine(),this._itemAlign(t)},onDragEnd:function(){this._clearAlignLine()},_itemAlign:function(e){var t=this,a=e.getBBox();console.log(a);var i={x:a.x+a.width/2,y:a.y},r={x:a.x+a.width/2,y:a.y+a.height/2},o={x:a.x+a.width/2,y:a.y+a.height},s={x:a.x,y:a.y+a.height/2},c={x:a.x+a.width,y:a.y+a.height/2},l=this.graph.getNodes();n(l,(function(l){var d=[],u=[],p=null,h=l.getBBox();if(n(t.getHorizontalLines(h),(function(e){d.push(t.getDistance(e,i)),d.push(t.getDistance(e,r)),d.push(t.getDistance(e,o))})),n(t.getVerticalLines(h),(function(e){u.push(t.getDistance(e,s)),u.push(t.getDistance(e,r)),u.push(t.getDistance(e,c))})),d.sort((function(e,t){return e.dis-t.dis})),u.sort((function(e,t){return e.dis-t.dis})),d.length>0&&d[0].dis<t.tolerance){e.attr({y:d[0].line[1]-d[0].point.y+a.y}),p={horizontals:[d[0]]};for(var f=1;f<3;f++)d[0].dis===d[f].dis&&p.horizontals.push(d[f])}if(u.length>0&&u[0].dis<t.tolerance){e.attr({x:u[0].line[0]-u[0].point.x+a.x}),p?p.verticals=[u[0]]:p={verticals:[u[0]]};for(var m=1;m<3;m++)u[0].dis===u[m].dis&&p.verticals.push(u[m])}p&&(p.bbox=a,t._addAlignLine(p))}))},_addAlignLine:function(e){var t=this.graph.get("group"),i=e.bbox,r=this.alignLineStyle,o=this._alignLines;e.horizontals&&n(e.horizontals,(function(e){var n,s,c=e.line,l=e.point,d=(c[0]+c[2])/2;l.x<d?(n=l.x-i.width/2,s=Math.max(c[0],c[2])):(n=l.x+i.width/2,s=Math.min(c[0],c[2]));var u=t.addShape("line",{attrs:a({x1:n,y1:c[1],x2:s,y2:c[1]},r),capture:!1});o.push(u)})),e.verticals&&n(e.verticals,(function(e){var n,s,c=e.line,l=e.point,d=(c[1]+c[3])/2;l.y<d?(n=l.y-i.height/2,s=Math.max(c[1],c[3])):(n=l.y+i.height/2,s=Math.min(c[1],c[3]));var u=t.addShape("line",{attrs:a({x1:c[0],y1:n,x2:c[0],y2:s},r),capture:!1});o.push(u)}))},getHorizontalLines:function(e){return[[e.minX,e.minY,e.maxX,e.minY],[e.minX,e.centerY,e.maxX,e.centerY],[e.minX,e.maxY,e.maxX,e.maxY]]},getVerticalLines:function(e){return[[e.minX,e.minY,e.minX,e.maxY],[e.centerX,e.minY,e.centerX,e.maxY],[e.maxX,e.minY,e.maxX,e.maxY]]},getDistance:function(e,t){return{line:e,point:t,dis:this.pointLineDistance(e[0],e[1],e[2],e[3],t.x,t.y)}},pointLineDistance:function(e,t,a,n,r,o){var s=[a-e,n-t];if(i.exactEquals(s,[0,0]))return NaN;var c=[-s[1],s[0]];return i.normalize(c,c),Math.abs(i.dot([r-e,o-t],c))},_clearAlignLine:function(){n(this._alignLines,(function(e){e.remove()})),this._alignLines=[],this.graph.paint()}})}),Se={getEvents:function(){return{"canvas:click":"onCanvasClick"}},onCanvasClick:function(){u.$emit("detailPanelReset")}},je={"hover-node":le,"add-edge":pe,"drag-item":ye,"select-node":be,"hover-edge":xe,keyboard:ke,"mulit-select":Oe,"add-menu":Ie,"canvas-click":Se};function Ne(){for(var e in je)ce.a.registerBehavior(e,je[e]);_e(ce.a)}var Pe={data:function(){return{resizeFunc:function(){},pageId:"graph-container",graph:null}},props:{height:{type:Number,default:0},width:{type:Number,default:0},data:{type:Object,default:function(){}}},created:function(){Ne()},mounted:function(){var e=this;this.$nextTick((function(){e.init()}))},methods:{init:function(){var e=this.height-145,t=this.width-575;this.graph=new ce.a.Graph({container:"graph-container",height:e,width:t,modes:{default:["drag-canvas","zoom-canvas","hover-node","select-node","hover-edge","keyboard","customer-events","add-menu","canvas-click"],mulitSelect:["mulit-select"],addEdge:["add-edge","drag-canvas","zoom-canvas","hover-edge","keyboard"],moveNode:["drag-item"]}});var a=this.$parent,n=a.editor,i=a.command;n.emit("afterAddPage",{graph:this.graph,command:i}),this.initResizeEvent(),this.readData()},readData:function(){var e=this.data;if(this.graphData=this.data,e){for(var t in e.nodes)switch(e.nodes[t].mType){case"startNode":e.nodes[t].id;break;case"endNode":e.nodes[t].id;break;case"cycleNode":e.nodes[t].id;break}this.graph.read(e)}},initResizeEvent:function(){var e=this.$refs["mountNode"],t=this.graph;this.resizeFunc=function(){t.changeSize(e.offsetWidth,window.innerHeight-90)},window.addEventListener("resize",this.resizeFunc)}}},Le=Pe,Fe=(a("eeae"),Object(v["a"])(Le,re,oe,!1,null,"6b21f458",null)),Ee=Fe.exports,Te=a("6fcf"),$e=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("ul",{ref:"contextMenu",staticClass:"el-scrollbar__view el-select-dropdown__list context-menu"},e._l(e.menus,(function(t){return a("li",{key:t.key,staticClass:"el-select-dropdown__item",on:{click:function(a){return e.handleClick(t)}}},[e._v(e._s(t.name))])})),0)])},Be=[],Me={data:function(){return{menus:[{key:1,name:"菜单1"},{key:2,name:"菜单2"}]}},created:function(){this.bindEvent()},methods:{init:function(){},bindEvent:function(){var e=this;u.$on("contextmenuClick",(function(t){var a=e.$refs.contextMenu;a.style.left=t.clientX-200+"px",a.style.top=t.clientY-60+"px",a.style.display="block"})),u.$on("mousedown",(function(){var t=e.$refs.contextMenu;t.style.display="none"}))},handleClick:function(e){alert(e.name);var t=this.$refs.contextMenu;t.style.display="none"}}},Ae=Me,Ue=(a("0d88"),Object(v["a"])(Ae,$e,Be,!1,null,null,null)),qe=Ue.exports,ze=a("9f12"),Ge=a("53fe"),Re=function(){function e(){Object(ze["a"])(this,e),this.id=Object(f["b"])()}return Object(Ge["a"])(e,[{key:"getGrpah",value:function(){return this.graph}},{key:"emit",value:function(e,t){"afterAddPage"===e&&(this.graph=t.graph),u.$emit(e,t)}},{key:"on",value:function(e){switch(e){case"changeNodeData":this.graph.refresh();break}}},{key:"add",value:function(e,t){this.graph.add(e,t)}},{key:"update",value:function(e,t){this.graph.update(e,t)}},{key:"remove",value:function(e){var t=this.graph.findById(e.id);this.graph.remove(t)}}]),e}(),Ve=(a("d81d"),function(){function e(t){Object(ze["a"])(this,e),Object(s["a"])(this,"editor",null),Object(s["a"])(this,"undoList",[]),Object(s["a"])(this,"redoList",[]),this.editor=t}return Object(Ge["a"])(e,[{key:"executeCommand",value:function(e,t){var a=this,n=[],i={};return t.map((function(t){if(i=t,"add"===e&&(i.id=t.type+Object(P["b"])(2)),"delete"===e)if("node"===t.getType()){var r=t.getEdges();i=t.getModel(),i.type=t.getType(),i.id=t.get("id"),r.forEach((function(e){var t=e.getModel();t.type="edge",t.id=e.get("id"),n.push(t)}))}else"edge"===t.getType()&&(i=t.getModel(),i.type=t.getType(),i.id=t.get("id"));n.push(i),a.doCommand(e,i)})),this.undoList.push({key:e,datas:n}),"delete"===e&&(this.redoList=[]),this.editor.emit(e,{undoList:this.undoList,redoList:this.redoList}),i.id}},{key:"doCommand",value:function(e,t){switch(e){case"add":this.add(t.type,t);break;case"update":this.update(t.item,t.newModel);break;case"delete":this.remove(t);break}}},{key:"add",value:function(e,t){this.editor.add(e,t)}},{key:"update",value:function(e,t){this.editor.update(e,t)}},{key:"remove",value:function(e){this.editor.remove(e)}},{key:"undo",value:function(){for(var e=this.undoList.pop(),t=[],a=[],n=0;n<e.datas.length;n++){var i=e.datas[n];"edge"!==i.type?(a.push(i),this.doundo(e.key,i)):t.push(i)}for(var r=0;r<t.length;r++){var o=t[r];o.source.destroyed&&(o.source=o.sourceId),o.target.destroyed&&(o.target=o.targetId),a.push(o),this.doundo(e.key,o)}this.redoList.push({key:e.key,datas:a}),this.editor.emit(e.key,{undoList:this.undoList,redoList:this.redoList})}},{key:"doundo",value:function(e,t){switch(e){case"add":this.remove(t);break;case"update":this.update(t.item,t.oldModel);break;case"delete":this.add(t.type,t);break}}},{key:"redo",value:function(){for(var e=this.redoList.pop(),t=[],a=[],n=0;n<e.datas.length;n++){var i=e.datas[n];"edge"!==i.type?(t.push(i),this.doredo(e.key,i)):a.push(i)}for(var r=0;r<a.length;r++){var o=a[r];o.source.destroyed&&(o.source=o.sourceId),o.target.destroyed&&(o.target=o.targetId),t.push(o),this.doredo(e.key,o)}this.undoList.push({key:e.key,datas:t}),this.editor.emit(e.key,{undoList:this.undoList,redoList:this.redoList})}},{key:"doredo",value:function(e,t){switch(e){case"add":this.add(t.type,t);break;case"update":this.update(t.item,t.newModel);break;case"delete":this.remove(t);break}}},{key:"delete",value:function(e){this.executeCommand("delete",[e])}}]),e}()),Ye=Ve,Xe=(a("21a6"),a("2f62"));function Je(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Ke(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Je(a,!0).forEach((function(t){Object(s["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Je(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var He={name:"G6Editor",components:{Toolbar:b,ItemPanel:A,DetailPanel:J,Minimap:ie,Page:Ee,ContextMenu:qe,Flow:Te["a"]},computed:Ke({},Object(Xe["b"])({user:"user"})),props:{height:{type:Number,default:document.documentElement.clientHeight},width:{type:Number,default:document.documentElement.clientWidth},data:{type:Object,default:function(){}},name:{type:String,default:""},id:{type:Number,default:-1},isEdit:{type:Boolean,default:!1},status:{type:String,default:"normal"}},created:function(){this.init()},data:function(){return{editor:{},command:null,graphData:{},saveDialogVisible:!1,typeOption:[{label:"普通流程",value:0},{label:"常驻流程",value:1}],saveForm:{type:0,name:"",canUse:0},saveRules:{name:[{required:!0,message:"请输入流程名称",trigger:"blur"}],type:[{required:!0,message:"请选择流程类型",trigger:"change"}]},testLoading:!1}},methods:{init:function(){this.editor=new Re,this.command=new Ye(this.editor)},checkPoint:function(e){this.graphData=e;var t=!0;for(var a in this.graphData.nodes)if(this.editor.graph.findById(this.graphData.nodes[a].id).clearStates("error"),this.graphData.nodes[a].attr){if(void 0!==this.graphData.nodes[a].attr.bindForm){var n=this.graphData.nodes[a].attrName.find((function(e){return"bindForm"===e.attribute}));if(n.required&&0===this.graphData.nodes[a].attr.bindForm.length){var i=this.editor.graph.findById(this.graphData.nodes[a].id);i.setState("error",!0),t=!1}}if(void 0!==this.graphData.nodes[a].attr.inChargeGroupID){var r=this.graphData.nodes[a].attrName.find((function(e){return"inChargeGroupID"===e.attribute}));if(r.required&&0===this.graphData.nodes[a].attr.inChargeGroupID.length){var o=this.editor.graph.findById(this.graphData.nodes[a].id);o.setState("error",!0),t=!1}}if(void 0!==this.graphData.nodes[a].attr.roomGroups){var s=this.graphData.nodes[a].attrName.find((function(e){return"roomGroups"===e.attribute}));if(s.required&&0===this.graphData.nodes[a].attr.roomGroups.length){var c=this.editor.graph.findById(this.graphData.nodes[a].id);c.setState("error",!0),t=!1}}}return this.editor.graph.paint(),t},handleSave:function(e,t){var a=this.checkPoint(e);a?this.handleShowSaveDialog(t):(this.graphData={},this.$notify.error({title:"错误",message:"请检查红色节点的属性是否填写完整"}))},getRunDto:function(e){var t,a,n,i,r,o,s,c;return regeneratorRuntime.async((function(l){while(1)switch(l.prev=l.next){case 0:t=e,l.t0=regeneratorRuntime.keys(t.nodes);case 2:if((l.t1=l.t0()).done){l.next=15;break}i=l.t1.value,l.t2=t.nodes[i].mType,l.next="startNode"===l.t2?7:"endNode"===l.t2?9:"cycleNode"===l.t2?11:13;break;case 7:return a=t.nodes[i].id,l.abrupt("break",13);case 9:return n=t.nodes[i].id,l.abrupt("break",13);case 11:return t.nodes[i].id,l.abrupt("break",13);case 13:l.next=2;break;case 15:return l.next=17,regeneratorRuntime.awrap(this.handleExpandEmbedNode(t));case 17:t=l.sent,r=[],l.t3=regeneratorRuntime.keys(t.nodes);case 20:if((l.t4=l.t3()).done){l.next=47;break}o=l.t4.value,s=void 0,s="cycleNode"===t.nodes[o].mType?this.findNextNodes(this.findPreviousNodes(t.nodes[o].id,t),t,!0):this.findNextNodes(t.nodes[o].id,t),c={nodeID:t.nodes[o].id},s.length>0&&(c.nextNodeID=s),l.t5=t.nodes[o].mType,l.next="startNode"===l.t5?29:"endNode"===l.t5?31:"cycleNode"===l.t5?34:"wfdNode"===l.t5?37:"syncNode"===l.t5?39:"concurrencyNode"===l.t5?41:43;break;case 29:return c.kind=1,l.abrupt("break",43);case 31:return c.beginNodeID=a,c.kind=2,l.abrupt("break",43);case 34:return c.kind=3,c.loopBeginNodeID=t.nodes[o].loopBeginNodeID,l.abrupt("break",43);case 37:return c.kind=0,l.abrupt("break",43);case 39:return t.nodes[o].syncEndID?c.kind=1:(c.kind=2,c.beginNodeID=t.nodes[o].syncBeginID),l.abrupt("break",43);case 41:return t.nodes[o].concurrencyEndID?c.kind=1:(c.kind=2,c.beginNodeID=t.nodes[o].concurrencyBeginID),l.abrupt("break",43);case 43:t.nodes[o].attr&&t.nodes[o].attr.loopBeginNodeID&&(c.loopBeginNodeID=t.nodes[o].attr.loopBeginNodeID),r.push(c),l.next=20;break;case 47:return l.abrupt("return",{beginID:a,endID:n,nodes:r});case 48:case"end":return l.stop()}}),null,this)},handleExpandEmbedNode:function(e){var t,a=this;return regeneratorRuntime.async((function(n){while(1)switch(n.prev=n.next){case 0:if(!e.nodes.find((function(e){return"embedNode"===e.mType}))){n.next=8;break}return n.next=3,regeneratorRuntime.awrap(function(){var t,n,i,s,c,l,d,u,p;return regeneratorRuntime.async((function(h){while(1)switch(h.prev=h.next){case 0:t=Object(P["a"])(e),n={},i=!0,s=!1,c=void 0,h.prev=5,l=function(){var e,i,o,s,c,l,d,p,h,f,m,g,v,y,b,x,k,w,D,C,O,I,_,S,j,N,P,L;return regeneratorRuntime.async((function(F){while(1)switch(F.prev=F.next){case 0:if(e=u.value,"embedNode"!==e.mType){F.next=79;break}return F.next=4,regeneratorRuntime.awrap(a.getProcessContent(e.attr.processID));case 4:if(i=F.sent,1!==i.data.resultCode){F.next=79;break}for(n=JSON.parse(i.data.objData.content),c=!0,l=!1,d=void 0,F.prev=10,p=t.edges[Symbol.iterator]();!(c=(h=p.next()).done);c=!0)f=h.value,f.targetId===e.id?o=f:f.sourceId===e.id&&(s=f);F.next=18;break;case 14:F.prev=14,F.t0=F["catch"](10),l=!0,d=F.t0;case 18:F.prev=18,F.prev=19,c||null==p.return||p.return();case 21:if(F.prev=21,!l){F.next=24;break}throw d;case 24:return F.finish(21);case 25:return F.finish(18);case 26:for(m=t.nodes.findIndex((function(t){return t.id===e.id})),t.nodes.splice(m,1),y=!0,b=!1,x=void 0,F.prev=31,k=n.nodes[Symbol.iterator]();!(y=(w=k.next()).done);y=!0)D=w.value,"startNode"===D.mType?g=D:"endNode"===D.mType&&(v=D);F.next=39;break;case 35:F.prev=35,F.t1=F["catch"](31),b=!0,x=F.t1;case 39:F.prev=39,F.prev=40,y||null==k.return||k.return();case 42:if(F.prev=42,!b){F.next=45;break}throw x;case 45:return F.finish(42);case 46:return F.finish(39);case 47:for(I=!0,_=!1,S=void 0,F.prev=50,j=n.edges[Symbol.iterator]();!(I=(N=j.next()).done);I=!0)P=N.value,P.sourceId===g.id?C=P:P.targetId===v.id&&(O=P);F.next=58;break;case 54:F.prev=54,F.t2=F["catch"](50),_=!0,S=F.t2;case 58:F.prev=58,F.prev=59,I||null==j.return||j.return();case 61:if(F.prev=61,!_){F.next=64;break}throw S;case 64:return F.finish(61);case 65:return F.finish(58);case 66:return t.edges.forEach((function(e,a,n){e.id===o.id?(t.edges[a].targetId=C.targetId,t.edges[a].target=C.target):e.id===s.id&&(t.edges[a].sourceId=O.sourceId,t.edges[a].source=O.source)})),L=n.nodes.findIndex((function(e){return e.id===g.id})),n.nodes.splice(L,1),L=n.nodes.findIndex((function(e){return e.id===v.id})),n.nodes.splice(L,1),L=n.edges.findIndex((function(e){return e.id===C.id})),n.edges.splice(L,1),L=n.edges.findIndex((function(e){return e.id===O.id})),n.edges.splice(L,1),t.nodes=[].concat(Object(r["a"])(t.nodes),Object(r["a"])(n.nodes)),t.edges=[].concat(Object(r["a"])(t.edges),Object(r["a"])(n.edges)),t=a.handleExpandEmbedNode(t),F.abrupt("return",{v:{v:t}});case 79:case"end":return F.stop()}}),null,null,[[10,14,18,26],[19,,21,25],[31,35,39,47],[40,,42,46],[50,54,58,66],[59,,61,65]])},d=t.nodes[Symbol.iterator]();case 8:if(i=(u=d.next()).done){h.next=17;break}return h.next=11,regeneratorRuntime.awrap(l());case 11:if(p=h.sent,"object"!==Object(o["a"])(p)){h.next=14;break}return h.abrupt("return",p.v);case 14:i=!0,h.next=8;break;case 17:h.next=23;break;case 19:h.prev=19,h.t0=h["catch"](5),s=!0,c=h.t0;case 23:h.prev=23,h.prev=24,i||null==d.return||d.return();case 26:if(h.prev=26,!s){h.next=29;break}throw c;case 29:return h.finish(26);case 30:return h.finish(23);case 31:case"end":return h.stop()}}),null,null,[[5,19,23,31],[24,,26,30]])}());case 3:if(t=n.sent,"object"!==Object(o["a"])(t)){n.next=6;break}return n.abrupt("return",t.v);case 6:n.next=9;break;case 8:return n.abrupt("return",e);case 9:case"end":return n.stop()}}))},handleTest:function(e){var t,a,n=this;return regeneratorRuntime.async((function(i){while(1)switch(i.prev=i.next){case 0:if(t=this.checkPoint(e),!t){i.next=9;break}return this.testLoading=!0,i.next=5,regeneratorRuntime.awrap(this.getRunDto(e));case 5:a=i.sent,this.axios.post(R["a"].runTest,this.qs.parse(a)).then((function(e){1===e.data.resultCode&&(n.testLoading=!1,n.$notify({title:"成功",message:e.data.objData,type:"success"}))})).catch((function(e){if(n.testLoading=!1,3001===e.response.data.resultCode){var t=!0,a=!1,i=void 0;try{for(var r,o=e.response.data.objData.nodeID[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var s=r.value,c=n.editor.graph.findById(s);c.clearStates("error"),c.setState("error",!0)}}catch(d){a=!0,i=d}finally{try{t||null==o.return||o.return()}finally{if(a)throw i}}n.editor.graph.paint();var l=e.response.data.objData.errorDetail.split("，")[0]+"，请检查标红节点是否有误";n.$notify.error({title:e.response.data.message,message:l,duration:0})}})),i.next=11;break;case 9:this.graphData={},this.$notify.error({title:"错误",message:"请检查红色节点的属性是否填写完整"});case 11:case"end":return i.stop()}}),null,this)},getProcessContent:function(e){return this.axios.post(R["a"].downloadOneProcess,this.qs.stringify({processId:e,userId:this.user.id}))},findNextNodes:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=[],i=function(i){if(t.edges[i].sourceId===e){var r=t.nodes.find((function(e){return e.id===t.edges[i].targetId}));if(a&&"cycleNode"!==r.mType&&n.push(t.edges[i].targetId),!a){if("cycleNode"===r.mType)return{v:Array.of(t.edges[i].targetId)};n.push(t.edges[i].targetId)}}};for(var r in t.edges){var s=i(r);if("object"===Object(o["a"])(s))return s.v}return n},findPreviousNodes:function(e,t){for(var a in t.edges)if(t.edges[a].targetId===e)return t.edges[a].sourceId},onSaveDialogClose:function(){this.resetSaveForm(),this.saveDialogVisible=!1},handleShowSaveDialog:function(e){switch(e){case"saveAs":this.saveDialogVisible=!0;break;case"save":this.isEdit?"normal"===this.status?this.handleUpdateFlow():"draft"===this.status&&this.handleUpdateDraft():this.saveDialogVisible=!0;break}},handleUpdateFlow:function(){var e=this,t=new FormData;t.append("processName",this.name);var a=new Blob([JSON.stringify(this.graphData)],{type:"text/plain;charset=utf-8"});t.append("processFile",new File([a],"flow"+Object(P["c"])(10)+".txt")),t.append("oldProcessId",this.id),t.append("runDtoStr",JSON.stringify(this.getRunDto(this.graphData))),t.append("canUse",this.saveForm.canUse),t.append("type",this.saveForm.type),this.axios.post(R["a"].updateProcess,t).then((function(t){1===t.data.resultCode&&e.$message({type:"success",message:t.data.message})})).catch((function(t){e.$message({type:"error",message:t.response.data.message})}))},handleUpdateDraft:function(){var e=this,t=new FormData;t.append("processName",this.name);var a=new Blob([JSON.stringify(this.graphData)],{type:"text/plain;charset=utf-8"});t.append("processFile",new File([a],"draftFlow"+Object(P["c"])(10)+".txt")),t.append("oldProcessId",this.id),this.axios.put(R["a"].updateDraft,t).then((function(t){1===t.data.resultCode&&e.$message({type:"success",message:t.data.message})})).catch((function(t){e.$message({type:"error",message:t.response.data.message})}))},onSave:function(){var e=this;this.$refs.saveForm.validate((function(t){if(!t)return!1;var a=new FormData;a.append("processName",e.saveForm.name);var n=new Blob([JSON.stringify(e.graphData)],{type:"text/plain;charset=utf-8"});a.append("processFile",new File([n],"flow"+Object(P["c"])(10)+".txt")),a.append("runDtoStr",JSON.stringify(e.getRunDto(e.graphData))),a.append("canUse",e.saveForm.canUse),a.append("type",e.saveForm.type),e.axios.post(R["a"].uploadProcess,a).then((function(t){1===t.data.resultCode?(e.$message({message:t.data.message,type:"success"}),e.resetSaveForm(),e.saveDialogVisible=!1):e.$message({message:t.data.message})})).catch((function(t){e.$message({type:"error",message:t.response.data.message})}))}))},onSaveAsDraft:function(){var e=this;this.$refs.saveForm.validate((function(t){if(!t)return!1;var a=new FormData;a.append("name",e.saveForm.name);var n=new Blob([JSON.stringify(e.graphData)],{type:"text/plain;charset=utf-8"});a.append("processFile",new File([n],"draftFlow"+Object(P["c"])(10)+".txt")),e.axios.post(R["a"].saveDraft,a).then((function(t){1===t.data.resultCode?(e.$message({message:t.data.message,type:"success"}),e.resetSaveForm(),e.saveDialogVisible=!1):e.$message({message:t.data.message})})).catch((function(t){e.$message({type:"error",message:t.response.data.message})}))}))},resetSaveForm:function(){this.$refs.saveForm.resetFields(),this.saveForm={type:0,name:"",canUse:0}}}},Ze=He,We=(a("1f00"),Object(v["a"])(Ze,n,i,!1,null,"021eefc0",null));t["a"]=We.exports},c48c:function(e,t,a){"use strict";var n=a("de45"),i=a.n(n);i.a},ca25:function(e,t,a){},ce5c:function(e,t,a){},dba7:function(e,t,a){"use strict";var n=a("ce5c"),i=a.n(n);i.a},de3a:function(e,t,a){},de45:function(e,t,a){},ed08:function(e,t,a){"use strict";a.d(t,"c",(function(){return i})),a.d(t,"d",(function(){return r})),a.d(t,"a",(function(){return o})),a.d(t,"b",(function(){return s}));a("a15b"),a("0d03"),a("a9e3"),a("d3b7"),a("e25e"),a("4d63"),a("ac1f"),a("25f0"),a("466d"),a("4d90"),a("5319"),a("1276");var n=a("bf2d");function i(e){if(e>21)return null;var t=new RegExp("(\\d{"+e+"})(\\.|$)"),a=(Array(e-1).join(0)+Math.pow(10,e)*Math.random()).match(t)[1];return a}function r(e,t){if(0===arguments.length)return null;var a,i=t||"{y}-{m}-{d} {h}:{i}:{s}";"object"===Object(n["a"])(e)?a=e:("string"===typeof e&&(e=/^[0-9]+$/.test(e)?parseInt(e):e.replace(new RegExp(/-/gm),"/").replace(/T/," ").split(".")[0]),"number"===typeof e&&10===e.toString().length&&(e*=1e3),a=new Date(e));var r={y:a.getFullYear(),m:a.getMonth()+1,d:a.getDate(),h:a.getHours(),i:a.getMinutes(),s:a.getSeconds(),a:a.getDay()},o=i.replace(/{([ymdhisa])+}/g,(function(e,t){var a=r[t];return"a"===t?["日","一","二","三","四","五","六"][a]:a.toString().padStart(2,"0")}));return o}function o(e){var t=JSON.stringify(e),a=JSON.parse(t);return a}function s(e){return Number(Math.random().toString().substr(3,e)+Date.now()).toString(32)}},eeae:function(e,t,a){"use strict";var n=a("99b5"),i=a.n(n);i.a}});
//# sourceMappingURL=app.1e0ad5f7.js.map